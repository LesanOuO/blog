<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>RabbitMQç¬”è®° | Lesan's Blog</title><meta name=keywords content="RabbitMQ,.NET"><meta name=description content="RabbitMQç®€è¿°
MQå…¨ç§°ä¸ºMessage Queue, æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºå¯¹åº”ç”¨ç¨‹åºçš„é€šä¿¡æ–¹æ³•ã€‚RabbitMQæ˜¯ä¸€ä¸ªåœ¨AMQPåŸºç¡€ä¸Šå®Œæ•´çš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿã€‚ä»–éµå¾ªMozilla Public Licenseå¼€æºåè®®ã€‚AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®) æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯ä¼ é€’æ‰€ä½¿ç”¨çš„åº”ç”¨å±‚åè®®è§„èŒƒï¼Œä½œä¸ºçº¿è·¯å±‚åè®®ï¼Œè€Œä¸æ˜¯APIï¼ˆä¾‹å¦‚JMSï¼‰ï¼ŒAMQP å®¢æˆ·ç«¯èƒ½å¤Ÿæ— è§†æ¶ˆæ¯çš„æ¥æºä»»æ„å‘é€å’Œæ¥å—ä¿¡æ¯ã€‚AMQPçš„åŸå§‹ç”¨é€”åªæ˜¯ä¸ºé‡‘èç•Œæä¾›ä¸€ä¸ªå¯ä»¥å½¼æ­¤åä½œçš„æ¶ˆæ¯åè®®ï¼Œè€Œç°åœ¨çš„ç›®æ ‡åˆ™æ˜¯ä¸ºé€šç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„æä¾›é€šç”¨æ„å»ºå·¥å…·ã€‚å› æ­¤ï¼Œé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ ï¼ˆMOMï¼‰ç³»ç»Ÿï¼Œä¾‹å¦‚å‘å¸ƒ/è®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰ä½œä¸ºåŸºæœ¬å…ƒç´ å®ç°ã€‚AMQPå½“ä¸­æœ‰å››ä¸ªæ¦‚å¿µéå¸¸é‡è¦ï¼ˆä¸€ä¸ªè™šæ‹Ÿä¸»æœºæŒæœ‰ä¸€ç»„äº¤æ¢æœºã€é˜Ÿåˆ—å’Œç»‘å®šï¼‰ï¼š"><meta name=author content="Lesan"><link rel=canonical href=https://lesanouo.github.io/blog/posts/knowledge/rabbitmq%E7%AC%94%E8%AE%B0/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://lesanouo.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lesanouo.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://lesanouo.github.io/blog/favicon.ico><link rel=apple-touch-icon href=https://lesanouo.github.io/blog/favicon.ico><link rel=mask-icon href=https://lesanouo.github.io/blog/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://lesanouo.github.io/blog/posts/knowledge/rabbitmq%E7%AC%94%E8%AE%B0/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://lesanouo.github.io/blog/posts/knowledge/rabbitmq%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="Lesan's Blog"><meta property="og:title" content="RabbitMQç¬”è®°"><meta property="og:description" content="RabbitMQç®€è¿° MQå…¨ç§°ä¸ºMessage Queue, æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºå¯¹åº”ç”¨ç¨‹åºçš„é€šä¿¡æ–¹æ³•ã€‚RabbitMQæ˜¯ä¸€ä¸ªåœ¨AMQPåŸºç¡€ä¸Šå®Œæ•´çš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿã€‚ä»–éµå¾ªMozilla Public Licenseå¼€æºåè®®ã€‚AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®) æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯ä¼ é€’æ‰€ä½¿ç”¨çš„åº”ç”¨å±‚åè®®è§„èŒƒï¼Œä½œä¸ºçº¿è·¯å±‚åè®®ï¼Œè€Œä¸æ˜¯APIï¼ˆä¾‹å¦‚JMSï¼‰ï¼ŒAMQP å®¢æˆ·ç«¯èƒ½å¤Ÿæ— è§†æ¶ˆæ¯çš„æ¥æºä»»æ„å‘é€å’Œæ¥å—ä¿¡æ¯ã€‚AMQPçš„åŸå§‹ç”¨é€”åªæ˜¯ä¸ºé‡‘èç•Œæä¾›ä¸€ä¸ªå¯ä»¥å½¼æ­¤åä½œçš„æ¶ˆæ¯åè®®ï¼Œè€Œç°åœ¨çš„ç›®æ ‡åˆ™æ˜¯ä¸ºé€šç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„æä¾›é€šç”¨æ„å»ºå·¥å…·ã€‚å› æ­¤ï¼Œé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ ï¼ˆMOMï¼‰ç³»ç»Ÿï¼Œä¾‹å¦‚å‘å¸ƒ/è®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰ä½œä¸ºåŸºæœ¬å…ƒç´ å®ç°ã€‚AMQPå½“ä¸­æœ‰å››ä¸ªæ¦‚å¿µéå¸¸é‡è¦ï¼ˆä¸€ä¸ªè™šæ‹Ÿä¸»æœºæŒæœ‰ä¸€ç»„äº¤æ¢æœºã€é˜Ÿåˆ—å’Œç»‘å®šï¼‰ï¼š"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-17T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-17T00:00:00+00:00"><meta property="article:tag" content="RabbitMQ"><meta property="article:tag" content=".NET"><meta name=twitter:card content="summary"><meta name=twitter:title content="RabbitMQç¬”è®°"><meta name=twitter:description content="RabbitMQç®€è¿°
MQå…¨ç§°ä¸ºMessage Queue, æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºå¯¹åº”ç”¨ç¨‹åºçš„é€šä¿¡æ–¹æ³•ã€‚RabbitMQæ˜¯ä¸€ä¸ªåœ¨AMQPåŸºç¡€ä¸Šå®Œæ•´çš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿã€‚ä»–éµå¾ªMozilla Public Licenseå¼€æºåè®®ã€‚AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®) æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯ä¼ é€’æ‰€ä½¿ç”¨çš„åº”ç”¨å±‚åè®®è§„èŒƒï¼Œä½œä¸ºçº¿è·¯å±‚åè®®ï¼Œè€Œä¸æ˜¯APIï¼ˆä¾‹å¦‚JMSï¼‰ï¼ŒAMQP å®¢æˆ·ç«¯èƒ½å¤Ÿæ— è§†æ¶ˆæ¯çš„æ¥æºä»»æ„å‘é€å’Œæ¥å—ä¿¡æ¯ã€‚AMQPçš„åŸå§‹ç”¨é€”åªæ˜¯ä¸ºé‡‘èç•Œæä¾›ä¸€ä¸ªå¯ä»¥å½¼æ­¤åä½œçš„æ¶ˆæ¯åè®®ï¼Œè€Œç°åœ¨çš„ç›®æ ‡åˆ™æ˜¯ä¸ºé€šç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„æä¾›é€šç”¨æ„å»ºå·¥å…·ã€‚å› æ­¤ï¼Œé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ ï¼ˆMOMï¼‰ç³»ç»Ÿï¼Œä¾‹å¦‚å‘å¸ƒ/è®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰ä½œä¸ºåŸºæœ¬å…ƒç´ å®ç°ã€‚AMQPå½“ä¸­æœ‰å››ä¸ªæ¦‚å¿µéå¸¸é‡è¦ï¼ˆä¸€ä¸ªè™šæ‹Ÿä¸»æœºæŒæœ‰ä¸€ç»„äº¤æ¢æœºã€é˜Ÿåˆ—å’Œç»‘å®šï¼‰ï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“š åšå®¢","item":"https://lesanouo.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"RabbitMQç¬”è®°","item":"https://lesanouo.github.io/blog/posts/knowledge/rabbitmq%E7%AC%94%E8%AE%B0/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"RabbitMQç¬”è®°","name":"RabbitMQç¬”è®°","description":"RabbitMQç®€è¿° MQå…¨ç§°ä¸ºMessage Queue, æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºå¯¹åº”ç”¨ç¨‹åºçš„é€šä¿¡æ–¹æ³•ã€‚RabbitMQæ˜¯ä¸€ä¸ªåœ¨AMQPåŸºç¡€ä¸Šå®Œæ•´çš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿã€‚ä»–éµå¾ªMozilla Public Licenseå¼€æºåè®®ã€‚AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®) æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯ä¼ é€’æ‰€ä½¿ç”¨çš„åº”ç”¨å±‚åè®®è§„èŒƒï¼Œä½œä¸ºçº¿è·¯å±‚åè®®ï¼Œè€Œä¸æ˜¯APIï¼ˆä¾‹å¦‚JMSï¼‰ï¼ŒAMQP å®¢æˆ·ç«¯èƒ½å¤Ÿæ— è§†æ¶ˆæ¯çš„æ¥æºä»»æ„å‘é€å’Œæ¥å—ä¿¡æ¯ã€‚AMQPçš„åŸå§‹ç”¨é€”åªæ˜¯ä¸ºé‡‘èç•Œæä¾›ä¸€ä¸ªå¯ä»¥å½¼æ­¤åä½œçš„æ¶ˆæ¯åè®®ï¼Œè€Œç°åœ¨çš„ç›®æ ‡åˆ™æ˜¯ä¸ºé€šç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„æä¾›é€šç”¨æ„å»ºå·¥å…·ã€‚å› æ­¤ï¼Œé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ ï¼ˆMOMï¼‰ç³»ç»Ÿï¼Œä¾‹å¦‚å‘å¸ƒ/è®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰ä½œä¸ºåŸºæœ¬å…ƒç´ å®ç°ã€‚AMQPå½“ä¸­æœ‰å››ä¸ªæ¦‚å¿µéå¸¸é‡è¦ï¼ˆä¸€ä¸ªè™šæ‹Ÿä¸»æœºæŒæœ‰ä¸€ç»„äº¤æ¢æœºã€é˜Ÿåˆ—å’Œç»‘å®šï¼‰ï¼š\n","keywords":["RabbitMQ",".NET"],"articleBody":"RabbitMQç®€è¿° MQå…¨ç§°ä¸ºMessage Queue, æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºå¯¹åº”ç”¨ç¨‹åºçš„é€šä¿¡æ–¹æ³•ã€‚RabbitMQæ˜¯ä¸€ä¸ªåœ¨AMQPåŸºç¡€ä¸Šå®Œæ•´çš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿã€‚ä»–éµå¾ªMozilla Public Licenseå¼€æºåè®®ã€‚AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®) æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯ä¼ é€’æ‰€ä½¿ç”¨çš„åº”ç”¨å±‚åè®®è§„èŒƒï¼Œä½œä¸ºçº¿è·¯å±‚åè®®ï¼Œè€Œä¸æ˜¯APIï¼ˆä¾‹å¦‚JMSï¼‰ï¼ŒAMQP å®¢æˆ·ç«¯èƒ½å¤Ÿæ— è§†æ¶ˆæ¯çš„æ¥æºä»»æ„å‘é€å’Œæ¥å—ä¿¡æ¯ã€‚AMQPçš„åŸå§‹ç”¨é€”åªæ˜¯ä¸ºé‡‘èç•Œæä¾›ä¸€ä¸ªå¯ä»¥å½¼æ­¤åä½œçš„æ¶ˆæ¯åè®®ï¼Œè€Œç°åœ¨çš„ç›®æ ‡åˆ™æ˜¯ä¸ºé€šç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„æä¾›é€šç”¨æ„å»ºå·¥å…·ã€‚å› æ­¤ï¼Œé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ ï¼ˆMOMï¼‰ç³»ç»Ÿï¼Œä¾‹å¦‚å‘å¸ƒ/è®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰ä½œä¸ºåŸºæœ¬å…ƒç´ å®ç°ã€‚AMQPå½“ä¸­æœ‰å››ä¸ªæ¦‚å¿µéå¸¸é‡è¦ï¼ˆä¸€ä¸ªè™šæ‹Ÿä¸»æœºæŒæœ‰ä¸€ç»„äº¤æ¢æœºã€é˜Ÿåˆ—å’Œç»‘å®šï¼‰ï¼š\nvirtual hostï¼Œè™šæ‹Ÿä¸»æœº exchangeï¼Œäº¤æ¢æœº queueï¼Œé˜Ÿåˆ— bindingï¼Œç»‘å®š æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ ä¸Šå›¾ä¸ºRabbitMQä¸­ä¸€äº›é‡è¦åè¯çš„æ¦‚è¿°ï¼Œå…¶ä¸­åŒ…æ‹¬Connectionã€Channelã€Exchangeã€Queueã€Bindã€Routing Key\nä¸Šå›¾ä¸ºæ¶ˆæ¯ä»ç”Ÿäº§åˆ°æ¶ˆè´¹çš„æ•´ä¸ªæµç¨‹ï¼Œå…¶ä¸­Exchangeï¼Œä¸Queueéƒ½æ˜¯å¯ä»¥è®¾ç½®ç›¸å…³å±æ€§ï¼Œé˜Ÿåˆ—çš„æŒä¹…åŒ–ï¼Œäº¤æ¢å™¨ç±»å‹åˆ¶å®š\nè¿™ä¸ªè¿‡ç¨‹èµ°åˆ†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œ1ã€å®¢æˆ·ç«¯ï¼ˆç”Ÿäº§æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œ2ã€RabbitMQæœåŠ¡ç«¯ï¼ˆè´Ÿè´£è·¯ç”±è§„åˆ™çš„ç»‘å®šä¸æ¶ˆæ¯çš„åˆ†å‘ï¼‰ï¼Œ3ã€å®¢æˆ·ç«¯ï¼ˆæ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼‰\nç”±å›¾å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªæ¶ˆæ¯å¯ä»¥èµ°ä¸€æ¬¡ç½‘ç»œå´è¢«åˆ†å‘åˆ°ä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åè¢«å¤šä¸ªçš„å®¢æˆ·ç«¯æ¶ˆè´¹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯RabbitMQçš„æ ¸å¿ƒæœºåˆ¶ï¼ŒRabbitMQçš„è·¯ç”±ç±»å‹ä¸æ¶ˆè´¹æ¨¡å¼\nRabbitMQä¸­Exchangeçš„ç±»å‹ ç±»å‹æœ‰4ç§ï¼Œdirectï¼Œfanoutï¼Œtopicï¼Œheadersã€‚å…¶ä¸­headersä¸å¸¸ç”¨ï¼Œæœ¬ç¯‡ä¸åšä»‹ç»ï¼Œå…¶ä»–ä¸‰ç§ç±»å‹ï¼Œä¼šåšè¯¦ç»†ä»‹ç»ã€‚\né‚£ä¹ˆè¿™äº›ç±»å‹æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯Exchangeä¸é˜Ÿåˆ—è¿›è¡Œç»‘å®šåï¼Œæ¶ˆæ¯æ ¹æ®exchangçš„ç±»å‹ï¼ŒæŒ‰ç…§ä¸åŒçš„ç»‘å®šè§„åˆ™åˆ†å‘æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ¶ˆæ¯è¢«åˆ†å‘ç»™å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ¶ˆæ¯åˆ†å‘åˆ°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚å…·ä½“è¯·çœ‹ä¸‹æ–‡ã€‚\nä»‹ç»ä¹‹åˆè¿˜è¦è¯´ä¸‹RoutingKeyï¼Œè¿™æ˜¯ä¸ªä»€ä¹ˆç©æ„å‘¢ï¼Ÿä»–æ˜¯exchangeä¸æ¶ˆæ¯é˜Ÿåˆ—ç»‘å®šä¸­çš„ä¸€ä¸ªæ ‡è¯†ã€‚æœ‰äº›è·¯ç”±ç±»å‹ä¼šæŒ‰ç…§æ ‡è¯†å¯¹åº”æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ‰äº›è·¯ç”±ç±»å‹å¿½ç•¥routingkeyã€‚å…·ä½“çœ‹ä¸‹æ–‡ã€‚\nExchangeç±»å‹direct æ ¹æ®äº¤æ¢å™¨åç§°ä¸routingkeyæ¥æ‰¾é˜Ÿåˆ—çš„\nNote:æ¶ˆæ¯ä»clientå‘å‡ºï¼Œä¼ é€ç»™äº¤æ¢å™¨ChangeAï¼ŒRoutingKeyä¸ºroutingkey.ZLH,é‚£ä¹ˆä¸ç®¡ä½ å‘é€ç»™Queue1ï¼Œè¿˜æ˜¯Queue2ä¸€ä¸ªæ¶ˆæ¯éƒ½ä¼šä¿å­˜åœ¨Queue1ï¼ŒQueue2ï¼ŒQueue3ï¼Œä¸‰ä¸ªé˜Ÿåˆ—ä¸­ã€‚è¿™å°±æ˜¯äº¤æ¢å™¨çš„directç±»å‹çš„è·¯ç”±è§„åˆ™ã€‚åªè¦æ‰¾åˆ°è·¯ç”±å™¨ä¸routingkeyç»‘å®šçš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆä»–æœ‰å¤šå°‘é˜Ÿåˆ—ï¼Œä»–å°±åˆ†å‘ç»™å¤šå°‘é˜Ÿåˆ—ã€‚\nExchangeç±»å‹fanout è¿™ä¸ªç±»å‹å¿½ç•¥Routingkeyï¼Œä»–ä¸ºå¹¿æ’­æ¨¡å¼\nNote:æ¶ˆæ¯ä»å®¢æˆ·ç«¯å‘å‡ºï¼Œåªè¦queueä¸exchangeæœ‰ç»‘å®šï¼Œé‚£ä¹ˆä»–ä¸ç®¡ä½ çš„Routingkeyæ˜¯ä»€ä¹ˆä»–éƒ½ä¼šå°†æ¶ˆæ¯åˆ†å‘ç»™æ‰€æœ‰ä¸è¯¥exchangç»‘å®šçš„é˜Ÿåˆ—ä¸­ã€‚\nExchangeç±»å‹topic è¿™ä¸ªç±»å‹çš„è·¯ç”±è§„åˆ™å¦‚æœä½ æŒæ¡å•¦ï¼Œé‚£æ˜¯ç›¸å½“çš„å¥½ç”¨ï¼Œä¸çµæ´»ã€‚ä»–æ˜¯æ ¹æ®RoutingKeyçš„è®¾ç½®ï¼Œæ¥åšåŒ¹é…çš„ï¼Œå…¶ä¸­è¿™é‡Œè¿˜æœ‰ä¸¤ä¸ªé€šé…ç¬¦ä¸ºï¼š\n*ï¼Œä»£è¡¨ä»»æ„çš„ä¸€ä¸ªè¯ã€‚ä¾‹å¦‚topic.zlh.*ï¼Œä»–èƒ½å¤ŸåŒ¹é…åˆ°ï¼Œtopic.zlh.one ,topic.zlh.two ,topic.zlh.abc, â€¦.\n#ï¼Œä»£è¡¨ä»»æ„å¤šä¸ªè¯ã€‚ä¾‹å¦‚topic.#ï¼Œä»–èƒ½å¤ŸåŒ¹é…åˆ°ï¼Œtopic.zlh.one ,topic.zlh.two ,topic.zlh.abc, â€¦.\nNoteï¼šè¿™ä¸ªå›¾çœ‹ä¸Šå»å¾ˆä¹±ï¼Œä½†æ˜¯ä»–æ˜¯æ ¹æ®åŒ¹é…ç¬¦åšåŒ¹é…çš„ï¼Œè¿™é‡Œæˆ‘å»ºè®®ä½ è‡ªå·±åšä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„å…·ä½“æ“ä½œã€‚\næ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹ä¸æ¶ˆæ¯ç¡®è®¤ æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹ Note:å¦‚æœä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­æœ‰å¤§é‡æ¶ˆæ¯ç­‰å¾…æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¤šä¸ªå®¢æˆ·ç«¯æ¥å¤„ç†æ¶ˆæ¯ï¼Œè¿™é‡Œçš„åˆ†å‘æœºåˆ¶æ˜¯é‡‡ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•ä¸­çš„è½®è¯¢ã€‚ç¬¬ä¸€ä¸ªæ¶ˆæ¯ç»™Aï¼Œä¸‹ä¸€ä¸ªæ¶ˆæ¯ç»™Bï¼Œä¸‹ä¸‹ä¸€ä¸ªæ¶ˆæ¯ç»™Aï¼Œä¸‹ä¸‹ä¸‹ä¸€ä¸ªæ¶ˆæ¯ç»™Bâ€¦â€¦ä»¥æ­¤ç±»æ¨\næ¶ˆæ¯ç¡®è®¤ ä¿è¯æ¶ˆæ¯çš„å®‰å…¨æ€§ï¼Œä¿è¯æ­¤æ¶ˆæ¯è¢«æ­£ç¡®å¤„ç†åæ‰èƒ½åœ¨æœåŠ¡ç«¯çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚é‚£ä¹ˆrabbitmqæä¾›å•¦ackåº”ç­”æœºåˆ¶ï¼Œæ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚\nackåº”ç­”æœ‰ä¸¤ç§æ–¹å¼ï¼š1ã€è‡ªåŠ¨åº”ç­”ï¼Œ2ã€æ‰‹åŠ¨åº”ç­”\nä½¿ç”¨ä¾‹å­ ç”Ÿäº§è€… using RabbitMQ.Client; using System; using System.Text; namespace RabbitMQProduct { internal class Program { static void Main(string[] args) { Console.WriteLine(\"Welcome to RabbitMQ Product!\"); DirectExchangeSendMsg(); // TopicExchangeSendMsg(); Console.WriteLine(\"æŒ‰ä»»æ„å€¼ï¼Œé€€å‡ºç¨‹åº\"); Console.ReadKey(); } /// /// è¿æ¥é…ç½® /// private static readonly ConnectionFactory rabbitMqFactory = new ConnectionFactory() { UserName = \"guest\", Password = \"guest\", Port = 5672, //VirtualHost = \"LesanVirtualHost\" }; /// /// è·¯ç”±åç§° /// const string ExchangeName = \"Lesan.exchange\"; //é˜Ÿåˆ—åç§° const string QueueName = \"Lesan.queue\"; /// /// è·¯ç”±åç§° /// const string TopExchangeName = \"topic.Lesan.exchange\"; //é˜Ÿåˆ—åç§° const string TopQueueName = \"topic.Lesan.queue\"; /// /// å•ç‚¹ç²¾ç¡®è·¯ç”±æ¨¡å¼ /// public static void DirectExchangeSendMsg() { using (IConnection conn = rabbitMqFactory.CreateConnection()) { using (IModel channel = conn.CreateModel()) { //è®¾ç½®äº¤æ¢å™¨çš„ç±»å‹ channel.ExchangeDeclare(ExchangeName, ExchangeType.Direct, durable: true, autoDelete: false, arguments: null); //å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¾ç½®é˜Ÿåˆ—æ˜¯å¦æŒä¹…åŒ–ï¼Œæ’ä»–æ€§ï¼Œä¸è‡ªåŠ¨åˆ é™¤ channel.QueueDeclare(QueueName, durable: true, autoDelete: false, exclusive: false, arguments: null); //ç»‘å®šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº¤æ¢å™¨ï¼Œroutingkey channel.QueueBind(QueueName, ExchangeName, routingKey: QueueName); var props = channel.CreateBasicProperties(); //é˜Ÿåˆ—æŒä¹…åŒ– props.Persistent = true; string vadata = Console.ReadLine(); while (vadata != \"exit\") { var msgBody = Encoding.UTF8.GetBytes(vadata); //å‘é€ä¿¡æ¯ channel.BasicPublish(exchange: ExchangeName, routingKey: QueueName, basicProperties: props, body: msgBody); Console.WriteLine(string.Format(\"***å‘é€æ—¶é—´:{0}ï¼Œå‘é€å®Œæˆï¼Œè¾“å…¥exité€€å‡ºæ¶ˆæ¯å‘é€\", DateTime.Now.ToString(\"yyyy-MM-dd HH:mm:ss\"))); vadata = Console.ReadLine(); } } } } /// /// topic æ¨¡ç³ŠåŒ¹é…æ¨¡å¼ï¼Œç¬¦å·â€œ#â€åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯ï¼Œç¬¦å·â€œ*â€åŒ¹é…ä¸å¤šä¸å°‘ä¸€ä¸ªè¯ã€‚å› æ­¤â€œlog.#â€èƒ½å¤ŸåŒ¹é…åˆ°â€œlog.info.oaâ€ï¼Œä½†æ˜¯â€œlog.*â€ åªä¼šåŒ¹é…åˆ°â€œlog.errorâ€ /// public static void TopicExchangeSendMsg() { using (IConnection conn = rabbitMqFactory.CreateConnection()) { using (IModel channel = conn.CreateModel()) { channel.ExchangeDeclare(TopExchangeName, ExchangeType.Topic, durable: false, autoDelete: false, arguments: null); channel.QueueDeclare(TopQueueName, durable: false, autoDelete: false, exclusive: false, arguments: null); channel.QueueBind(TopQueueName, TopExchangeName, routingKey: TopQueueName); //var props = channel.CreateBasicProperties(); //props.Persistent = true; string vadata = Console.ReadLine(); while (vadata != \"exit\") { var msgBody = Encoding.UTF8.GetBytes(vadata); channel.BasicPublish(exchange: TopExchangeName, routingKey: TopQueueName, basicProperties: null, body: msgBody); Console.WriteLine(string.Format(\"***å‘é€æ—¶é—´:{0}ï¼Œå‘é€å®Œæˆï¼Œè¾“å…¥exité€€å‡ºæ¶ˆæ¯å‘é€\", DateTime.Now.ToString(\"yyyy-MM-dd HH:mm:ss\"))); vadata = Console.ReadLine(); } } } } } } æ¶ˆè´¹è€… using RabbitMQ.Client; using RabbitMQ.Client.Events; using System; using System.Text; namespace RabbitMQConsumer { internal class Program { static void Main(string[] args) { Console.WriteLine(\"Welcome to RabbitMQ Consumer!\"); //DirectAcceptExchange(); //DirectAcceptExchangeEvent(); DirectAcceptExchangeTask(); //TopicAcceptExchange(); Console.WriteLine(\"æŒ‰ä»»æ„å€¼ï¼Œé€€å‡ºç¨‹åº\"); Console.ReadKey(); } /// /// è¿æ¥é…ç½® /// private static readonly ConnectionFactory rabbitMqFactory = new ConnectionFactory() { UserName = \"guest\", Password = \"guest\", Port = 5672, //VirtualHost = \"LesanVirtualHost\" }; /// /// è·¯ç”±åç§° /// const string ExchangeName = \"Lesan.exchange\"; //é˜Ÿåˆ—åç§° const string QueueName = \"Lesan.queue\"; /// /// è·¯ç”±åç§° /// const string TopExchangeName = \"topic.Lesan.exchange\"; //é˜Ÿåˆ—åç§° const string TopQueueName = \"topic.Lesan.queue\"; /// /// åŸºäºæ—¶é—´è½®è¯¢çš„ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´è·å–ä¸€æ¬¡ /// public static void DirectAcceptExchange() { using (IConnection conn = rabbitMqFactory.CreateConnection()) { using (IModel channel = conn.CreateModel()) { //è®¾ç½®äº¤æ¢å™¨çš„ç±»å‹ channel.ExchangeDeclare(ExchangeName, ExchangeType.Direct, durable: true, autoDelete: false, arguments: null); //å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¾ç½®é˜Ÿåˆ—æ˜¯å¦æŒä¹…åŒ–ï¼Œæ’ä»–æ€§ï¼Œä¸è‡ªåŠ¨åˆ é™¤ channel.QueueDeclare(QueueName, durable: true, autoDelete: false, exclusive: false, arguments: null); //ç»‘å®šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº¤æ¢å™¨ï¼Œroutingkey channel.QueueBind(QueueName, ExchangeName, routingKey: QueueName); while (true) { BasicGetResult msgResponse = channel.BasicGet(QueueName, true); if (msgResponse != null) { var msgBody = Encoding.UTF8.GetString(msgResponse.Body.ToArray()); Console.WriteLine(string.Format(\"***æ¥æ”¶æ—¶é—´:{0}ï¼Œæ¶ˆæ¯å†…å®¹ï¼š{1}\", DateTime.Now.ToString(\"yyyy-MM-dd HH:mm:ss\"), msgBody)); } System.Threading.Thread.Sleep(TimeSpan.FromSeconds(1)); } } } } /// /// åŸºäºäº‹ä»¶çš„ï¼Œå½“æ¶ˆæ¯åˆ°è¾¾æ—¶è§¦å‘äº‹ä»¶ï¼Œè·å–æ•°æ® /// public static void DirectAcceptExchangeEvent() { using (IConnection conn = rabbitMqFactory.CreateConnection()) { using (IModel channel = conn.CreateModel()) { //channel.ExchangeDeclare(ExchangeName, \"direct\", durable: true, autoDelete: false, arguments: null); channel.QueueDeclare(QueueName, durable: true, autoDelete: false, exclusive: false, arguments: null); //channel.QueueBind(QueueName, ExchangeName, routingKey: QueueName); var consumer = new EventingBasicConsumer(channel); consumer.Received += (model, ea) =\u003e { var msgBody = Encoding.UTF8.GetString(ea.Body.ToArray()); Console.WriteLine(string.Format(\"***æ¥æ”¶æ—¶é—´:{0}ï¼Œæ¶ˆæ¯å†…å®¹ï¼š{1}\", DateTime.Now.ToString(\"yyyy-MM-dd HH:mm:ss\"), msgBody)); }; channel.BasicConsume(QueueName, true, consumer: consumer); Console.WriteLine(\"æŒ‰ä»»æ„å€¼ï¼Œé€€å‡ºç¨‹åº\"); Console.ReadKey(); } } } /// /// åŸºäºäº‹ä»¶çš„ï¼Œå½“æ¶ˆæ¯åˆ°è¾¾æ—¶è§¦å‘äº‹ä»¶ï¼Œè·å–æ•°æ® /// public static void DirectAcceptExchangeTask() { using (IConnection conn = rabbitMqFactory.CreateConnection()) { using (IModel channel = conn.CreateModel()) { //channel.ExchangeDeclare(ExchangeName, \"direct\", durable: true, autoDelete: false, arguments: null); channel.QueueDeclare(QueueName, durable: true, autoDelete: false, exclusive: false, arguments: null); channel.BasicQos(prefetchSize: 0, prefetchCount: 1, global: false);//å‘Šè¯‰brokeråŒä¸€æ—¶é—´åªå¤„ç†ä¸€ä¸ªæ¶ˆæ¯ //channel.QueueBind(QueueName, ExchangeName, routingKey: QueueName); //å®šä¹‰è¿™ä¸ªé˜Ÿåˆ—çš„æ¶ˆè´¹è€… var consumer = new EventingBasicConsumer(channel); consumer.Received += (model, ea) =\u003e { var msgBody = Encoding.UTF8.GetString(ea.Body.ToArray()); Console.WriteLine(string.Format(\"***æ¥æ”¶æ—¶é—´:{0}ï¼Œæ¶ˆæ¯å†…å®¹ï¼š{1}\", DateTime.Now.ToString(\"yyyy-MM-dd HH:mm:ss\"), msgBody)); int dots = msgBody.Split('.').Length - 1; System.Threading.Thread.Sleep(dots * 1000); //å¤„ç†å®Œæˆï¼Œå‘Šè¯‰Brokerå¯ä»¥æœåŠ¡ç«¯å¯ä»¥åˆ é™¤æ¶ˆæ¯ï¼Œåˆ†é…æ–°çš„æ¶ˆæ¯è¿‡æ¥ channel.BasicAck(deliveryTag: ea.DeliveryTag, multiple: false); }; //noAckè®¾ç½®false,å‘Šè¯‰brokerï¼Œå‘é€æ¶ˆæ¯ä¹‹åï¼Œæ¶ˆæ¯æš‚æ—¶ä¸è¦åˆ é™¤ï¼Œç­‰æ¶ˆè´¹è€…å¤„ç†å®Œæˆå†è¯´ //falseä¸ºæ‰‹åŠ¨åº”ç­”ï¼Œtrueä¸ºè‡ªåŠ¨åº”ç­” channel.BasicConsume(QueueName, false, consumer: consumer); Console.WriteLine(\"æŒ‰ä»»æ„å€¼ï¼Œé€€å‡ºç¨‹åº\"); Console.ReadKey(); } } } /// /// topic æ¨¡ç³ŠåŒ¹é…æ¨¡å¼ï¼Œç¬¦å·â€œ#â€åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯ï¼Œç¬¦å·â€œ*â€åŒ¹é…ä¸å¤šä¸å°‘ä¸€ä¸ªè¯ã€‚å› æ­¤â€œlog.#â€èƒ½å¤ŸåŒ¹é…åˆ°â€œlog.info.oaâ€ï¼Œä½†æ˜¯â€œlog.*â€ åªä¼šåŒ¹é…åˆ°â€œlog.errorâ€ /// public static void TopicAcceptExchange() { using (IConnection conn = rabbitMqFactory.CreateConnection()) { using (IModel channel = conn.CreateModel()) { channel.ExchangeDeclare(TopExchangeName, ExchangeType.Topic, durable: false, autoDelete: false, arguments: null); channel.QueueDeclare(TopQueueName, durable: false, autoDelete: false, exclusive: false, arguments: null); channel.BasicQos(prefetchSize: 0, prefetchCount: 1, global: false); channel.QueueBind(TopQueueName, TopExchangeName, routingKey: TopQueueName); var consumer = new EventingBasicConsumer(channel); consumer.Received += (model, ea) =\u003e { var msgBody = Encoding.UTF8.GetString(ea.Body.ToArray()); Console.WriteLine(string.Format(\"***æ¥æ”¶æ—¶é—´:{0}ï¼Œæ¶ˆæ¯å†…å®¹ï¼š{1}\", DateTime.Now.ToString(\"yyyy-MM-dd HH:mm:ss\"), msgBody)); int dots = msgBody.Split('.').Length - 1; System.Threading.Thread.Sleep(dots * 1000); Console.WriteLine(\" [x] Done\"); channel.BasicAck(deliveryTag: ea.DeliveryTag, multiple: false); }; channel.BasicConsume(TopQueueName, false, consumer: consumer); Console.WriteLine(\"æŒ‰ä»»æ„å€¼ï¼Œé€€å‡ºç¨‹åº\"); Console.ReadKey(); } } } } } å¼•ç”¨ ä»¥ä¸Šç¬”è®°æ‘˜å½•è‡ªç½‘ç»œ\nhttps://www.cnblogs.com/knowledgesea/p/5296008.html https://www.cnblogs.com/personblog/p/10681741.html\n","wordCount":"3582","inLanguage":"zh-cn","datePublished":"2022-02-17T00:00:00Z","dateModified":"2022-02-17T00:00:00Z","author":{"@type":"Person","name":"Lesan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lesanouo.github.io/blog/posts/knowledge/rabbitmq%E7%AC%94%E8%AE%B0/"},"publisher":{"@type":"Organization","name":"Lesan's Blog","logo":{"@type":"ImageObject","url":"https://lesanouo.github.io/blog/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lesanouo.github.io/blog/ accesskey=h title="Lesan's Blog (Alt + H)">Lesan's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lesanouo.github.io/blog/archives title="ğŸ“š å½’æ¡£"><span>ğŸ“š å½’æ¡£</span></a></li><li><a href=https://lesanouo.github.io/blog/categories/ title="ğŸ—ƒï¸ åˆ†ç±»"><span>ğŸ—ƒï¸ åˆ†ç±»</span></a></li><li><a href=https://lesanouo.github.io/blog/tags/ title="ğŸ·ï¸ æ ‡ç­¾"><span>ğŸ·ï¸ æ ‡ç­¾</span></a></li><li><a href=https://lesanouo.github.io/blog/search/ title="ğŸ” æœç´¢"><span>ğŸ” æœç´¢</span></a></li><li><a href=https://lesanouo.github.io/blog/about/ title="ğŸ‘¨â€ğŸ’» å…³äºæˆ‘"><span>ğŸ‘¨â€ğŸ’» å…³äºæˆ‘</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lesanouo.github.io/blog/>Home</a>&nbsp;Â»&nbsp;<a href=https://lesanouo.github.io/blog/posts/>ğŸ“š åšå®¢</a></div><h1 class="post-title entry-hint-parent">RabbitMQç¬”è®°</h1><div class=post-meta><span title='2022-02-17 00:00:00 +0000 UTC'>2022-02-17</span>&nbsp;Â·&nbsp;8 min&nbsp;Â·&nbsp;Lesan</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#rabbitmq%e7%ae%80%e8%bf%b0 aria-label=RabbitMQç®€è¿°>RabbitMQç®€è¿°</a></li><li><a href=#%e6%b6%88%e6%81%af%e4%bc%a0%e9%80%92%e8%bf%87%e7%a8%8b aria-label=æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹>æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹</a></li><li><a href=#rabbitmq%e4%b8%adexchange%e7%9a%84%e7%b1%bb%e5%9e%8b aria-label=RabbitMQä¸­Exchangeçš„ç±»å‹>RabbitMQä¸­Exchangeçš„ç±»å‹</a><ul><li><a href=#exchange%e7%b1%bb%e5%9e%8bdirect aria-label=Exchangeç±»å‹direct>Exchangeç±»å‹direct</a></li><li><a href=#exchange%e7%b1%bb%e5%9e%8bfanout aria-label=Exchangeç±»å‹fanout>Exchangeç±»å‹fanout</a></li><li><a href=#exchange%e7%b1%bb%e5%9e%8btopic aria-label=Exchangeç±»å‹topic>Exchangeç±»å‹topic</a></li></ul></li><li><a href=#%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97%e7%9a%84%e6%b6%88%e8%b4%b9%e4%b8%8e%e6%b6%88%e6%81%af%e7%a1%ae%e8%ae%a4 aria-label=æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹ä¸æ¶ˆæ¯ç¡®è®¤>æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹ä¸æ¶ˆæ¯ç¡®è®¤</a><ul><li><a href=#%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97%e7%9a%84%e6%b6%88%e8%b4%b9 aria-label=æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹>æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹</a></li><li><a href=#%e6%b6%88%e6%81%af%e7%a1%ae%e8%ae%a4 aria-label=æ¶ˆæ¯ç¡®è®¤>æ¶ˆæ¯ç¡®è®¤</a></li></ul></li><li><a href=#%e4%bd%bf%e7%94%a8%e4%be%8b%e5%ad%90 aria-label=ä½¿ç”¨ä¾‹å­>ä½¿ç”¨ä¾‹å­</a><ul><li><a href=#%e7%94%9f%e4%ba%a7%e8%80%85 aria-label=ç”Ÿäº§è€…>ç”Ÿäº§è€…</a></li><li><a href=#%e6%b6%88%e8%b4%b9%e8%80%85 aria-label=æ¶ˆè´¹è€…>æ¶ˆè´¹è€…</a></li></ul></li><li><a href=#%e5%bc%95%e7%94%a8 aria-label=å¼•ç”¨>å¼•ç”¨</a></li></ul></div></details></div><div class=post-content><h2 id=rabbitmqç®€è¿°>RabbitMQç®€è¿°<a hidden class=anchor aria-hidden=true href=#rabbitmqç®€è¿°>#</a></h2><p>MQå…¨ç§°ä¸ºMessage Queue, æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºå¯¹åº”ç”¨ç¨‹åºçš„é€šä¿¡æ–¹æ³•ã€‚RabbitMQæ˜¯ä¸€ä¸ªåœ¨AMQPåŸºç¡€ä¸Šå®Œæ•´çš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿã€‚ä»–éµå¾ªMozilla Public Licenseå¼€æºåè®®ã€‚AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®) æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯ä¼ é€’æ‰€ä½¿ç”¨çš„åº”ç”¨å±‚åè®®è§„èŒƒï¼Œä½œä¸ºçº¿è·¯å±‚åè®®ï¼Œè€Œä¸æ˜¯APIï¼ˆä¾‹å¦‚JMSï¼‰ï¼ŒAMQP å®¢æˆ·ç«¯èƒ½å¤Ÿæ— è§†æ¶ˆæ¯çš„æ¥æºä»»æ„å‘é€å’Œæ¥å—ä¿¡æ¯ã€‚AMQPçš„åŸå§‹ç”¨é€”åªæ˜¯ä¸ºé‡‘èç•Œæä¾›ä¸€ä¸ªå¯ä»¥å½¼æ­¤åä½œçš„æ¶ˆæ¯åè®®ï¼Œè€Œç°åœ¨çš„ç›®æ ‡åˆ™æ˜¯ä¸ºé€šç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„æä¾›é€šç”¨æ„å»ºå·¥å…·ã€‚å› æ­¤ï¼Œé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ ï¼ˆMOMï¼‰ç³»ç»Ÿï¼Œä¾‹å¦‚å‘å¸ƒ/è®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰ä½œä¸ºåŸºæœ¬å…ƒç´ å®ç°ã€‚AMQPå½“ä¸­æœ‰å››ä¸ªæ¦‚å¿µéå¸¸é‡è¦ï¼ˆä¸€ä¸ªè™šæ‹Ÿä¸»æœºæŒæœ‰ä¸€ç»„äº¤æ¢æœºã€é˜Ÿåˆ—å’Œç»‘å®šï¼‰ï¼š</p><ol><li><code>virtual host</code>ï¼Œè™šæ‹Ÿä¸»æœº</li><li><code>exchange</code>ï¼Œäº¤æ¢æœº</li><li><code>queue</code>ï¼Œé˜Ÿåˆ—</li><li><code>binding</code>ï¼Œç»‘å®š</li></ol><h2 id=æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹>æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹<a hidden class=anchor aria-hidden=true href=#æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹>#</a></h2><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/LesanOuO/images@master/img/rabbitmq1.jpg></p><p>ä¸Šå›¾ä¸ºRabbitMQä¸­ä¸€äº›é‡è¦åè¯çš„æ¦‚è¿°ï¼Œå…¶ä¸­åŒ…æ‹¬Connectionã€Channelã€Exchangeã€Queueã€Bindã€Routing Key</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/LesanOuO/images@master/img/rabbitmq2.jpg></p><p>ä¸Šå›¾ä¸ºæ¶ˆæ¯ä»ç”Ÿäº§åˆ°æ¶ˆè´¹çš„æ•´ä¸ªæµç¨‹ï¼Œå…¶ä¸­Exchangeï¼Œä¸Queueéƒ½æ˜¯å¯ä»¥è®¾ç½®ç›¸å…³å±æ€§ï¼Œé˜Ÿåˆ—çš„æŒä¹…åŒ–ï¼Œäº¤æ¢å™¨ç±»å‹åˆ¶å®š</p><p>è¿™ä¸ªè¿‡ç¨‹èµ°åˆ†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œ1ã€å®¢æˆ·ç«¯ï¼ˆç”Ÿäº§æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œ2ã€RabbitMQæœåŠ¡ç«¯ï¼ˆè´Ÿè´£è·¯ç”±è§„åˆ™çš„ç»‘å®šä¸æ¶ˆæ¯çš„åˆ†å‘ï¼‰ï¼Œ3ã€å®¢æˆ·ç«¯ï¼ˆæ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼‰</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/LesanOuO/images@master/img/rabbitmq3.jpg></p><p>ç”±å›¾å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªæ¶ˆæ¯å¯ä»¥èµ°ä¸€æ¬¡ç½‘ç»œå´è¢«åˆ†å‘åˆ°ä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åè¢«å¤šä¸ªçš„å®¢æˆ·ç«¯æ¶ˆè´¹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯RabbitMQçš„æ ¸å¿ƒæœºåˆ¶ï¼ŒRabbitMQçš„è·¯ç”±ç±»å‹ä¸æ¶ˆè´¹æ¨¡å¼</p><h2 id=rabbitmqä¸­exchangeçš„ç±»å‹>RabbitMQä¸­Exchangeçš„ç±»å‹<a hidden class=anchor aria-hidden=true href=#rabbitmqä¸­exchangeçš„ç±»å‹>#</a></h2><p>ç±»å‹æœ‰4ç§ï¼Œdirectï¼Œfanoutï¼Œtopicï¼Œheadersã€‚å…¶ä¸­headersä¸å¸¸ç”¨ï¼Œæœ¬ç¯‡ä¸åšä»‹ç»ï¼Œå…¶ä»–ä¸‰ç§ç±»å‹ï¼Œä¼šåšè¯¦ç»†ä»‹ç»ã€‚</p><p>é‚£ä¹ˆè¿™äº›ç±»å‹æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯Exchangeä¸é˜Ÿåˆ—è¿›è¡Œç»‘å®šåï¼Œæ¶ˆæ¯æ ¹æ®exchangçš„ç±»å‹ï¼ŒæŒ‰ç…§ä¸åŒçš„ç»‘å®šè§„åˆ™åˆ†å‘æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ¶ˆæ¯è¢«åˆ†å‘ç»™å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ¶ˆæ¯åˆ†å‘åˆ°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚å…·ä½“è¯·çœ‹ä¸‹æ–‡ã€‚</p><p>ä»‹ç»ä¹‹åˆè¿˜è¦è¯´ä¸‹RoutingKeyï¼Œè¿™æ˜¯ä¸ªä»€ä¹ˆç©æ„å‘¢ï¼Ÿä»–æ˜¯exchangeä¸æ¶ˆæ¯é˜Ÿåˆ—ç»‘å®šä¸­çš„ä¸€ä¸ªæ ‡è¯†ã€‚æœ‰äº›è·¯ç”±ç±»å‹ä¼šæŒ‰ç…§æ ‡è¯†å¯¹åº”æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ‰äº›è·¯ç”±ç±»å‹å¿½ç•¥routingkeyã€‚å…·ä½“çœ‹ä¸‹æ–‡ã€‚</p><h3 id=exchangeç±»å‹direct>Exchangeç±»å‹direct<a hidden class=anchor aria-hidden=true href=#exchangeç±»å‹direct>#</a></h3><p>æ ¹æ®äº¤æ¢å™¨åç§°ä¸routingkeyæ¥æ‰¾é˜Ÿåˆ—çš„</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/LesanOuO/images@master/img/20220217105315.png></p><p>Note:æ¶ˆæ¯ä»clientå‘å‡ºï¼Œä¼ é€ç»™äº¤æ¢å™¨ChangeAï¼ŒRoutingKeyä¸ºroutingkey.ZLH,é‚£ä¹ˆä¸ç®¡ä½ å‘é€ç»™Queue1ï¼Œè¿˜æ˜¯Queue2ä¸€ä¸ªæ¶ˆæ¯éƒ½ä¼šä¿å­˜åœ¨Queue1ï¼ŒQueue2ï¼ŒQueue3ï¼Œä¸‰ä¸ªé˜Ÿåˆ—ä¸­ã€‚è¿™å°±æ˜¯äº¤æ¢å™¨çš„directç±»å‹çš„è·¯ç”±è§„åˆ™ã€‚åªè¦æ‰¾åˆ°è·¯ç”±å™¨ä¸routingkeyç»‘å®šçš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆä»–æœ‰å¤šå°‘é˜Ÿåˆ—ï¼Œä»–å°±åˆ†å‘ç»™å¤šå°‘é˜Ÿåˆ—ã€‚</p><h3 id=exchangeç±»å‹fanout>Exchangeç±»å‹fanout<a hidden class=anchor aria-hidden=true href=#exchangeç±»å‹fanout>#</a></h3><p>è¿™ä¸ªç±»å‹å¿½ç•¥Routingkeyï¼Œä»–ä¸ºå¹¿æ’­æ¨¡å¼</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/LesanOuO/images@master/img/20220217105352.png></p><p>Note:æ¶ˆæ¯ä»å®¢æˆ·ç«¯å‘å‡ºï¼Œåªè¦queueä¸exchangeæœ‰ç»‘å®šï¼Œé‚£ä¹ˆä»–ä¸ç®¡ä½ çš„Routingkeyæ˜¯ä»€ä¹ˆä»–éƒ½ä¼šå°†æ¶ˆæ¯åˆ†å‘ç»™æ‰€æœ‰ä¸è¯¥exchangç»‘å®šçš„é˜Ÿåˆ—ä¸­ã€‚</p><h3 id=exchangeç±»å‹topic>Exchangeç±»å‹topic<a hidden class=anchor aria-hidden=true href=#exchangeç±»å‹topic>#</a></h3><p>è¿™ä¸ªç±»å‹çš„è·¯ç”±è§„åˆ™å¦‚æœä½ æŒæ¡å•¦ï¼Œé‚£æ˜¯ç›¸å½“çš„å¥½ç”¨ï¼Œä¸çµæ´»ã€‚ä»–æ˜¯æ ¹æ®RoutingKeyçš„è®¾ç½®ï¼Œæ¥åšåŒ¹é…çš„ï¼Œå…¶ä¸­è¿™é‡Œè¿˜æœ‰ä¸¤ä¸ªé€šé…ç¬¦ä¸ºï¼š</p><p>*ï¼Œä»£è¡¨ä»»æ„çš„ä¸€ä¸ªè¯ã€‚ä¾‹å¦‚topic.zlh.*ï¼Œä»–èƒ½å¤ŸåŒ¹é…åˆ°ï¼Œtopic.zlh.one ,topic.zlh.two ,topic.zlh.abc, &mldr;.</p><p>#ï¼Œä»£è¡¨ä»»æ„å¤šä¸ªè¯ã€‚ä¾‹å¦‚topic.#ï¼Œä»–èƒ½å¤ŸåŒ¹é…åˆ°ï¼Œtopic.zlh.one ,topic.zlh.two ,topic.zlh.abc, &mldr;.</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/LesanOuO/images@master/img/20220217105423.png></p><p>Noteï¼šè¿™ä¸ªå›¾çœ‹ä¸Šå»å¾ˆä¹±ï¼Œä½†æ˜¯ä»–æ˜¯æ ¹æ®åŒ¹é…ç¬¦åšåŒ¹é…çš„ï¼Œè¿™é‡Œæˆ‘å»ºè®®ä½ è‡ªå·±åšä¸‹æ¶ˆæ¯é˜Ÿåˆ—çš„å…·ä½“æ“ä½œã€‚</p><h2 id=æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹ä¸æ¶ˆæ¯ç¡®è®¤>æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹ä¸æ¶ˆæ¯ç¡®è®¤<a hidden class=anchor aria-hidden=true href=#æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹ä¸æ¶ˆæ¯ç¡®è®¤>#</a></h2><h3 id=æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹>æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹<a hidden class=anchor aria-hidden=true href=#æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹>#</a></h3><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/LesanOuO/images@master/img/20220217110443.png></p><p>Note:å¦‚æœä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­æœ‰å¤§é‡æ¶ˆæ¯ç­‰å¾…æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¤šä¸ªå®¢æˆ·ç«¯æ¥å¤„ç†æ¶ˆæ¯ï¼Œè¿™é‡Œçš„åˆ†å‘æœºåˆ¶æ˜¯é‡‡ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•ä¸­çš„è½®è¯¢ã€‚ç¬¬ä¸€ä¸ªæ¶ˆæ¯ç»™Aï¼Œä¸‹ä¸€ä¸ªæ¶ˆæ¯ç»™Bï¼Œä¸‹ä¸‹ä¸€ä¸ªæ¶ˆæ¯ç»™Aï¼Œä¸‹ä¸‹ä¸‹ä¸€ä¸ªæ¶ˆæ¯ç»™B&mldr;&mldr;ä»¥æ­¤ç±»æ¨</p><h3 id=æ¶ˆæ¯ç¡®è®¤>æ¶ˆæ¯ç¡®è®¤<a hidden class=anchor aria-hidden=true href=#æ¶ˆæ¯ç¡®è®¤>#</a></h3><p>ä¿è¯æ¶ˆæ¯çš„å®‰å…¨æ€§ï¼Œä¿è¯æ­¤æ¶ˆæ¯è¢«æ­£ç¡®å¤„ç†åæ‰èƒ½åœ¨æœåŠ¡ç«¯çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚é‚£ä¹ˆrabbitmqæä¾›å•¦ackåº”ç­”æœºåˆ¶ï¼Œæ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚</p><p>ackåº”ç­”æœ‰ä¸¤ç§æ–¹å¼ï¼š1ã€è‡ªåŠ¨åº”ç­”ï¼Œ2ã€æ‰‹åŠ¨åº”ç­”</p><h2 id=ä½¿ç”¨ä¾‹å­>ä½¿ç”¨ä¾‹å­<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨ä¾‹å­>#</a></h2><h3 id=ç”Ÿäº§è€…>ç”Ÿäº§è€…<a hidden class=anchor aria-hidden=true href=#ç”Ÿäº§è€…>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>RabbitMQ.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nn>RabbitMQProduct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>internal</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Welcome to RabbitMQ Product!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>DirectExchangeSendMsg</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=c1>// TopicExchangeSendMsg();</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;æŒ‰ä»»æ„å€¼ï¼Œé€€å‡ºç¨‹åº&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>ReadKey</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// è¿æ¥é…ç½®</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kd>static</span> <span class=k>readonly</span> <span class=n>ConnectionFactory</span> <span class=n>rabbitMqFactory</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ConnectionFactory</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>UserName</span> <span class=p>=</span> <span class=s>&#34;guest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Password</span> <span class=p>=</span> <span class=s>&#34;guest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Port</span> <span class=p>=</span> <span class=m>5672</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=c1>//VirtualHost = &#34;LesanVirtualHost&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// è·¯ç”±åç§°</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>const</span> <span class=kt>string</span> <span class=n>ExchangeName</span> <span class=p>=</span> <span class=s>&#34;Lesan.exchange&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//é˜Ÿåˆ—åç§°</span>
</span></span><span class=line><span class=cl>        <span class=kd>const</span> <span class=kt>string</span> <span class=n>QueueName</span> <span class=p>=</span> <span class=s>&#34;Lesan.queue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// è·¯ç”±åç§°</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>const</span> <span class=kt>string</span> <span class=n>TopExchangeName</span> <span class=p>=</span> <span class=s>&#34;topic.Lesan.exchange&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//é˜Ÿåˆ—åç§°</span>
</span></span><span class=line><span class=cl>        <span class=kd>const</span> <span class=kt>string</span> <span class=n>TopQueueName</span> <span class=p>=</span> <span class=s>&#34;topic.Lesan.queue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>///  å•ç‚¹ç²¾ç¡®è·¯ç”±æ¨¡å¼</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>DirectExchangeSendMsg</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>using</span> <span class=p>(</span><span class=n>IConnection</span> <span class=n>conn</span> <span class=p>=</span> <span class=n>rabbitMqFactory</span><span class=p>.</span><span class=n>CreateConnection</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>using</span> <span class=p>(</span><span class=n>IModel</span> <span class=n>channel</span> <span class=p>=</span> <span class=n>conn</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//è®¾ç½®äº¤æ¢å™¨çš„ç±»å‹</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>ExchangeDeclare</span><span class=p>(</span><span class=n>ExchangeName</span><span class=p>,</span> <span class=n>ExchangeType</span><span class=p>.</span><span class=n>Direct</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span> <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>arguments</span><span class=p>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¾ç½®é˜Ÿåˆ—æ˜¯å¦æŒä¹…åŒ–ï¼Œæ’ä»–æ€§ï¼Œä¸è‡ªåŠ¨åˆ é™¤</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span><span class=n>QueueName</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span> <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>arguments</span><span class=p>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//ç»‘å®šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº¤æ¢å™¨ï¼Œroutingkey</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>QueueBind</span><span class=p>(</span><span class=n>QueueName</span><span class=p>,</span> <span class=n>ExchangeName</span><span class=p>,</span> <span class=n>routingKey</span><span class=p>:</span> <span class=n>QueueName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=kt>var</span> <span class=n>props</span> <span class=p>=</span> <span class=n>channel</span><span class=p>.</span><span class=n>CreateBasicProperties</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//é˜Ÿåˆ—æŒä¹…åŒ–</span>
</span></span><span class=line><span class=cl>                    <span class=n>props</span><span class=p>.</span><span class=n>Persistent</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=kt>string</span> <span class=n>vadata</span> <span class=p>=</span> <span class=n>Console</span><span class=p>.</span><span class=n>ReadLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=k>while</span> <span class=p>(</span><span class=n>vadata</span> <span class=p>!=</span> <span class=s>&#34;exit&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>var</span> <span class=n>msgBody</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>vadata</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=c1>//å‘é€ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>                        <span class=n>channel</span><span class=p>.</span><span class=n>BasicPublish</span><span class=p>(</span><span class=n>exchange</span><span class=p>:</span> <span class=n>ExchangeName</span><span class=p>,</span> <span class=n>routingKey</span><span class=p>:</span> <span class=n>QueueName</span><span class=p>,</span> <span class=n>basicProperties</span><span class=p>:</span> <span class=n>props</span><span class=p>,</span> <span class=n>body</span><span class=p>:</span> <span class=n>msgBody</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;***å‘é€æ—¶é—´:{0}ï¼Œå‘é€å®Œæˆï¼Œè¾“å…¥exité€€å‡ºæ¶ˆæ¯å‘é€&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>ToString</span><span class=p>(</span><span class=s>&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>                        <span class=n>vadata</span> <span class=p>=</span> <span class=n>Console</span><span class=p>.</span><span class=n>ReadLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// topic æ¨¡ç³ŠåŒ¹é…æ¨¡å¼ï¼Œç¬¦å·â€œ#â€åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯ï¼Œç¬¦å·â€œ*â€åŒ¹é…ä¸å¤šä¸å°‘ä¸€ä¸ªè¯ã€‚å› æ­¤â€œlog.#â€èƒ½å¤ŸåŒ¹é…åˆ°â€œlog.info.oaâ€ï¼Œä½†æ˜¯â€œlog.*â€ åªä¼šåŒ¹é…åˆ°â€œlog.errorâ€</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>TopicExchangeSendMsg</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>using</span> <span class=p>(</span><span class=n>IConnection</span> <span class=n>conn</span> <span class=p>=</span> <span class=n>rabbitMqFactory</span><span class=p>.</span><span class=n>CreateConnection</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>using</span> <span class=p>(</span><span class=n>IModel</span> <span class=n>channel</span> <span class=p>=</span> <span class=n>conn</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>ExchangeDeclare</span><span class=p>(</span><span class=n>TopExchangeName</span><span class=p>,</span> <span class=n>ExchangeType</span><span class=p>.</span><span class=n>Topic</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>arguments</span><span class=p>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span><span class=n>TopQueueName</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>arguments</span><span class=p>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>QueueBind</span><span class=p>(</span><span class=n>TopQueueName</span><span class=p>,</span> <span class=n>TopExchangeName</span><span class=p>,</span> <span class=n>routingKey</span><span class=p>:</span> <span class=n>TopQueueName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//var props = channel.CreateBasicProperties();</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//props.Persistent = true;</span>
</span></span><span class=line><span class=cl>                    <span class=kt>string</span> <span class=n>vadata</span> <span class=p>=</span> <span class=n>Console</span><span class=p>.</span><span class=n>ReadLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=k>while</span> <span class=p>(</span><span class=n>vadata</span> <span class=p>!=</span> <span class=s>&#34;exit&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>var</span> <span class=n>msgBody</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>vadata</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>channel</span><span class=p>.</span><span class=n>BasicPublish</span><span class=p>(</span><span class=n>exchange</span><span class=p>:</span> <span class=n>TopExchangeName</span><span class=p>,</span> <span class=n>routingKey</span><span class=p>:</span> <span class=n>TopQueueName</span><span class=p>,</span> <span class=n>basicProperties</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span> <span class=n>body</span><span class=p>:</span> <span class=n>msgBody</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;***å‘é€æ—¶é—´:{0}ï¼Œå‘é€å®Œæˆï¼Œè¾“å…¥exité€€å‡ºæ¶ˆæ¯å‘é€&#34;</span><span class=p>,</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>ToString</span><span class=p>(</span><span class=s>&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>                        <span class=n>vadata</span> <span class=p>=</span> <span class=n>Console</span><span class=p>.</span><span class=n>ReadLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=æ¶ˆè´¹è€…>æ¶ˆè´¹è€…<a hidden class=anchor aria-hidden=true href=#æ¶ˆè´¹è€…>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>RabbitMQ.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>RabbitMQ.Client.Events</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nn>RabbitMQConsumer</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>internal</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Welcome to RabbitMQ Consumer!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=c1>//DirectAcceptExchange();</span>
</span></span><span class=line><span class=cl>            <span class=c1>//DirectAcceptExchangeEvent();</span>
</span></span><span class=line><span class=cl>            <span class=n>DirectAcceptExchangeTask</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=c1>//TopicAcceptExchange();</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;æŒ‰ä»»æ„å€¼ï¼Œé€€å‡ºç¨‹åº&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>ReadKey</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// è¿æ¥é…ç½®</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kd>static</span> <span class=k>readonly</span> <span class=n>ConnectionFactory</span> <span class=n>rabbitMqFactory</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ConnectionFactory</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>UserName</span> <span class=p>=</span> <span class=s>&#34;guest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Password</span> <span class=p>=</span> <span class=s>&#34;guest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Port</span> <span class=p>=</span> <span class=m>5672</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=c1>//VirtualHost = &#34;LesanVirtualHost&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// è·¯ç”±åç§°</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>const</span> <span class=kt>string</span> <span class=n>ExchangeName</span> <span class=p>=</span> <span class=s>&#34;Lesan.exchange&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//é˜Ÿåˆ—åç§°</span>
</span></span><span class=line><span class=cl>        <span class=kd>const</span> <span class=kt>string</span> <span class=n>QueueName</span> <span class=p>=</span> <span class=s>&#34;Lesan.queue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// è·¯ç”±åç§°</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>const</span> <span class=kt>string</span> <span class=n>TopExchangeName</span> <span class=p>=</span> <span class=s>&#34;topic.Lesan.exchange&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//é˜Ÿåˆ—åç§°</span>
</span></span><span class=line><span class=cl>        <span class=kd>const</span> <span class=kt>string</span> <span class=n>TopQueueName</span> <span class=p>=</span> <span class=s>&#34;topic.Lesan.queue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// åŸºäºæ—¶é—´è½®è¯¢çš„ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´è·å–ä¸€æ¬¡</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>DirectAcceptExchange</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>using</span> <span class=p>(</span><span class=n>IConnection</span> <span class=n>conn</span> <span class=p>=</span> <span class=n>rabbitMqFactory</span><span class=p>.</span><span class=n>CreateConnection</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>using</span> <span class=p>(</span><span class=n>IModel</span> <span class=n>channel</span> <span class=p>=</span> <span class=n>conn</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//è®¾ç½®äº¤æ¢å™¨çš„ç±»å‹</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>ExchangeDeclare</span><span class=p>(</span><span class=n>ExchangeName</span><span class=p>,</span> <span class=n>ExchangeType</span><span class=p>.</span><span class=n>Direct</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span> <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>arguments</span><span class=p>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¾ç½®é˜Ÿåˆ—æ˜¯å¦æŒä¹…åŒ–ï¼Œæ’ä»–æ€§ï¼Œä¸è‡ªåŠ¨åˆ é™¤</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span><span class=n>QueueName</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span> <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>arguments</span><span class=p>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//ç»‘å®šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº¤æ¢å™¨ï¼Œroutingkey</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>QueueBind</span><span class=p>(</span><span class=n>QueueName</span><span class=p>,</span> <span class=n>ExchangeName</span><span class=p>,</span> <span class=n>routingKey</span><span class=p>:</span> <span class=n>QueueName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>while</span> <span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>BasicGetResult</span> <span class=n>msgResponse</span> <span class=p>=</span> <span class=n>channel</span><span class=p>.</span><span class=n>BasicGet</span><span class=p>(</span><span class=n>QueueName</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=n>msgResponse</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=kt>var</span> <span class=n>msgBody</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>msgResponse</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>ToArray</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;***æ¥æ”¶æ—¶é—´:{0}ï¼Œæ¶ˆæ¯å†…å®¹ï¼š{1}&#34;</span><span class=p>,</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>ToString</span><span class=p>(</span><span class=s>&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class=p>),</span> <span class=n>msgBody</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=n>System</span><span class=p>.</span><span class=n>Threading</span><span class=p>.</span><span class=n>Thread</span><span class=p>.</span><span class=n>Sleep</span><span class=p>(</span><span class=n>TimeSpan</span><span class=p>.</span><span class=n>FromSeconds</span><span class=p>(</span><span class=m>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// åŸºäºäº‹ä»¶çš„ï¼Œå½“æ¶ˆæ¯åˆ°è¾¾æ—¶è§¦å‘äº‹ä»¶ï¼Œè·å–æ•°æ®</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>DirectAcceptExchangeEvent</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>using</span> <span class=p>(</span><span class=n>IConnection</span> <span class=n>conn</span> <span class=p>=</span> <span class=n>rabbitMqFactory</span><span class=p>.</span><span class=n>CreateConnection</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>using</span> <span class=p>(</span><span class=n>IModel</span> <span class=n>channel</span> <span class=p>=</span> <span class=n>conn</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//channel.ExchangeDeclare(ExchangeName, &#34;direct&#34;, durable: true, autoDelete: false, arguments: null);</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span><span class=n>QueueName</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span> <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>arguments</span><span class=p>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//channel.QueueBind(QueueName, ExchangeName, routingKey: QueueName);</span>
</span></span><span class=line><span class=cl>                    <span class=kt>var</span> <span class=n>consumer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>EventingBasicConsumer</span><span class=p>(</span><span class=n>channel</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>consumer</span><span class=p>.</span><span class=n>Received</span> <span class=p>+=</span> <span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>ea</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>var</span> <span class=n>msgBody</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>ToArray</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;***æ¥æ”¶æ—¶é—´:{0}ï¼Œæ¶ˆæ¯å†…å®¹ï¼š{1}&#34;</span><span class=p>,</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>ToString</span><span class=p>(</span><span class=s>&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class=p>),</span> <span class=n>msgBody</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                    <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>BasicConsume</span><span class=p>(</span><span class=n>QueueName</span><span class=p>,</span> <span class=kc>true</span><span class=p>,</span> <span class=n>consumer</span><span class=p>:</span> <span class=n>consumer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;æŒ‰ä»»æ„å€¼ï¼Œé€€å‡ºç¨‹åº&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>Console</span><span class=p>.</span><span class=n>ReadKey</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// åŸºäºäº‹ä»¶çš„ï¼Œå½“æ¶ˆæ¯åˆ°è¾¾æ—¶è§¦å‘äº‹ä»¶ï¼Œè·å–æ•°æ®</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>DirectAcceptExchangeTask</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>using</span> <span class=p>(</span><span class=n>IConnection</span> <span class=n>conn</span> <span class=p>=</span> <span class=n>rabbitMqFactory</span><span class=p>.</span><span class=n>CreateConnection</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>using</span> <span class=p>(</span><span class=n>IModel</span> <span class=n>channel</span> <span class=p>=</span> <span class=n>conn</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//channel.ExchangeDeclare(ExchangeName, &#34;direct&#34;, durable: true, autoDelete: false, arguments: null);</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span><span class=n>QueueName</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span> <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>arguments</span><span class=p>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>BasicQos</span><span class=p>(</span><span class=n>prefetchSize</span><span class=p>:</span> <span class=m>0</span><span class=p>,</span> <span class=n>prefetchCount</span><span class=p>:</span> <span class=m>1</span><span class=p>,</span> <span class=n>global</span><span class=p>:</span> <span class=kc>false</span><span class=p>);</span><span class=c1>//å‘Šè¯‰brokeråŒä¸€æ—¶é—´åªå¤„ç†ä¸€ä¸ªæ¶ˆæ¯</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//channel.QueueBind(QueueName, ExchangeName, routingKey: QueueName);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=c1>//å®šä¹‰è¿™ä¸ªé˜Ÿåˆ—çš„æ¶ˆè´¹è€…</span>
</span></span><span class=line><span class=cl>                    <span class=kt>var</span> <span class=n>consumer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>EventingBasicConsumer</span><span class=p>(</span><span class=n>channel</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>consumer</span><span class=p>.</span><span class=n>Received</span> <span class=p>+=</span> <span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>ea</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>var</span> <span class=n>msgBody</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>ToArray</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;***æ¥æ”¶æ—¶é—´:{0}ï¼Œæ¶ˆæ¯å†…å®¹ï¼š{1}&#34;</span><span class=p>,</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>ToString</span><span class=p>(</span><span class=s>&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class=p>),</span> <span class=n>msgBody</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                        <span class=kt>int</span> <span class=n>dots</span> <span class=p>=</span> <span class=n>msgBody</span><span class=p>.</span><span class=n>Split</span><span class=p>(</span><span class=sc>&#39;.&#39;</span><span class=p>).</span><span class=n>Length</span> <span class=p>-</span> <span class=m>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>System</span><span class=p>.</span><span class=n>Threading</span><span class=p>.</span><span class=n>Thread</span><span class=p>.</span><span class=n>Sleep</span><span class=p>(</span><span class=n>dots</span> <span class=p>*</span> <span class=m>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=c1>//å¤„ç†å®Œæˆï¼Œå‘Šè¯‰Brokerå¯ä»¥æœåŠ¡ç«¯å¯ä»¥åˆ é™¤æ¶ˆæ¯ï¼Œåˆ†é…æ–°çš„æ¶ˆæ¯è¿‡æ¥</span>
</span></span><span class=line><span class=cl>                        <span class=n>channel</span><span class=p>.</span><span class=n>BasicAck</span><span class=p>(</span><span class=n>deliveryTag</span><span class=p>:</span> <span class=n>ea</span><span class=p>.</span><span class=n>DeliveryTag</span><span class=p>,</span> <span class=n>multiple</span><span class=p>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//noAckè®¾ç½®false,å‘Šè¯‰brokerï¼Œå‘é€æ¶ˆæ¯ä¹‹åï¼Œæ¶ˆæ¯æš‚æ—¶ä¸è¦åˆ é™¤ï¼Œç­‰æ¶ˆè´¹è€…å¤„ç†å®Œæˆå†è¯´</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//falseä¸ºæ‰‹åŠ¨åº”ç­”ï¼Œtrueä¸ºè‡ªåŠ¨åº”ç­”</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>BasicConsume</span><span class=p>(</span><span class=n>QueueName</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=n>consumer</span><span class=p>:</span> <span class=n>consumer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;æŒ‰ä»»æ„å€¼ï¼Œé€€å‡ºç¨‹åº&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>Console</span><span class=p>.</span><span class=n>ReadKey</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// topic æ¨¡ç³ŠåŒ¹é…æ¨¡å¼ï¼Œç¬¦å·â€œ#â€åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯ï¼Œç¬¦å·â€œ*â€åŒ¹é…ä¸å¤šä¸å°‘ä¸€ä¸ªè¯ã€‚å› æ­¤â€œlog.#â€èƒ½å¤ŸåŒ¹é…åˆ°â€œlog.info.oaâ€ï¼Œä½†æ˜¯â€œlog.*â€ åªä¼šåŒ¹é…åˆ°â€œlog.errorâ€</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>TopicAcceptExchange</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>using</span> <span class=p>(</span><span class=n>IConnection</span> <span class=n>conn</span> <span class=p>=</span> <span class=n>rabbitMqFactory</span><span class=p>.</span><span class=n>CreateConnection</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>using</span> <span class=p>(</span><span class=n>IModel</span> <span class=n>channel</span> <span class=p>=</span> <span class=n>conn</span><span class=p>.</span><span class=n>CreateModel</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>ExchangeDeclare</span><span class=p>(</span><span class=n>TopExchangeName</span><span class=p>,</span> <span class=n>ExchangeType</span><span class=p>.</span><span class=n>Topic</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>arguments</span><span class=p>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>QueueDeclare</span><span class=p>(</span><span class=n>TopQueueName</span><span class=p>,</span> <span class=n>durable</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>autoDelete</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>exclusive</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=n>arguments</span><span class=p>:</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>BasicQos</span><span class=p>(</span><span class=n>prefetchSize</span><span class=p>:</span> <span class=m>0</span><span class=p>,</span> <span class=n>prefetchCount</span><span class=p>:</span> <span class=m>1</span><span class=p>,</span> <span class=n>global</span><span class=p>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>QueueBind</span><span class=p>(</span><span class=n>TopQueueName</span><span class=p>,</span> <span class=n>TopExchangeName</span><span class=p>,</span> <span class=n>routingKey</span><span class=p>:</span> <span class=n>TopQueueName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=kt>var</span> <span class=n>consumer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>EventingBasicConsumer</span><span class=p>(</span><span class=n>channel</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>consumer</span><span class=p>.</span><span class=n>Received</span> <span class=p>+=</span> <span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>ea</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>var</span> <span class=n>msgBody</span> <span class=p>=</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>UTF8</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>ea</span><span class=p>.</span><span class=n>Body</span><span class=p>.</span><span class=n>ToArray</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;***æ¥æ”¶æ—¶é—´:{0}ï¼Œæ¶ˆæ¯å†…å®¹ï¼š{1}&#34;</span><span class=p>,</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>ToString</span><span class=p>(</span><span class=s>&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class=p>),</span> <span class=n>msgBody</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                        <span class=kt>int</span> <span class=n>dots</span> <span class=p>=</span> <span class=n>msgBody</span><span class=p>.</span><span class=n>Split</span><span class=p>(</span><span class=sc>&#39;.&#39;</span><span class=p>).</span><span class=n>Length</span> <span class=p>-</span> <span class=m>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>System</span><span class=p>.</span><span class=n>Threading</span><span class=p>.</span><span class=n>Thread</span><span class=p>.</span><span class=n>Sleep</span><span class=p>(</span><span class=n>dots</span> <span class=p>*</span> <span class=m>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34; [x] Done&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>channel</span><span class=p>.</span><span class=n>BasicAck</span><span class=p>(</span><span class=n>deliveryTag</span><span class=p>:</span> <span class=n>ea</span><span class=p>.</span><span class=n>DeliveryTag</span><span class=p>,</span> <span class=n>multiple</span><span class=p>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=n>channel</span><span class=p>.</span><span class=n>BasicConsume</span><span class=p>(</span><span class=n>TopQueueName</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=n>consumer</span><span class=p>:</span> <span class=n>consumer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;æŒ‰ä»»æ„å€¼ï¼Œé€€å‡ºç¨‹åº&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>Console</span><span class=p>.</span><span class=n>ReadKey</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=å¼•ç”¨>å¼•ç”¨<a hidden class=anchor aria-hidden=true href=#å¼•ç”¨>#</a></h2><p>ä»¥ä¸Šç¬”è®°æ‘˜å½•è‡ªç½‘ç»œ</p><blockquote><p><a href=https://www.cnblogs.com/knowledgesea/p/5296008.html>https://www.cnblogs.com/knowledgesea/p/5296008.html</a>
<a href=https://www.cnblogs.com/personblog/p/10681741.html>https://www.cnblogs.com/personblog/p/10681741.html</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://lesanouo.github.io/blog/tags/rabbitmq/>RabbitMQ</a></li><li><a href=https://lesanouo.github.io/blog/tags/.net/>.NET</a></li></ul><nav class=paginav><a class=prev href=https://lesanouo.github.io/blog/posts/operation/%E5%9C%A8.net%E4%B8%AD%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/><span class=title>Â«</span><br><span>åœ¨.NETä¸­å®ç°æ¶ˆæ¯æ¨é€çš„ä¸‰ç§æ–¹å¼</span>
</a><a class=next href=https://lesanouo.github.io/blog/posts/snippet/linux/><span class=title>Â»</span><br><span>Linux ä»£ç ç‰‡æ®µ</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://lesanouo.github.io/blog/>Lesan's Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>