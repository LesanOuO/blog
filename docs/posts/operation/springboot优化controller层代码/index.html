<!doctype html><html lang=zh-cn dir=auto><head><script src="/blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=blog/livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SpringBootä¼˜åŒ–Controllerå±‚ä»£ç  | Lesan's Blog</title><meta name=keywords content="SpringBoot"><meta name=description content="æœ¬ç¯‡ä¸»è¦ä»‹ç»çš„å°±æ˜¯ controller å±‚çš„ä¸€äº›ä¼˜é›…æŠ€å·§ï¼Œä¸€ä¸ªå®Œæ•´çš„åç«¯è¯·æ±‚ç”±4éƒ¨åˆ†ç»„æˆï¼š1. æ¥å£åœ°å€(ä¹Ÿå°±æ˜¯URLåœ°å€)ã€2. è¯·æ±‚æ–¹å¼(ä¸€èˆ¬å°±æ˜¯getã€setï¼Œå½“ç„¶è¿˜æœ‰putã€delete)ã€3. è¯·æ±‚æ•°æ®(requestï¼Œæœ‰headè·Ÿbody)ã€4. å“åº”æ•°æ®(response)"><meta name=author content="Lesan"><link rel=canonical href=http://localhost:1313/blog/posts/operation/springboot%E4%BC%98%E5%8C%96controller%E5%B1%82%E4%BB%A3%E7%A0%81/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/blog/favicon.ico><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/blog/favicon.ico><link rel=apple-touch-icon href=http://localhost:1313/blog/favicon.ico><link rel=mask-icon href=http://localhost:1313/blog/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=http://localhost:1313/blog/posts/operation/springboot%E4%BC%98%E5%8C%96controller%E5%B1%82%E4%BB%A3%E7%A0%81/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="http://localhost:1313/blog/posts/operation/springboot%E4%BC%98%E5%8C%96controller%E5%B1%82%E4%BB%A3%E7%A0%81/"><meta property="og:site_name" content="Lesan's Blog"><meta property="og:title" content="SpringBootä¼˜åŒ–Controllerå±‚ä»£ç "><meta property="og:description" content="æœ¬ç¯‡ä¸»è¦ä»‹ç»çš„å°±æ˜¯ controller å±‚çš„ä¸€äº›ä¼˜é›…æŠ€å·§ï¼Œä¸€ä¸ªå®Œæ•´çš„åç«¯è¯·æ±‚ç”±4éƒ¨åˆ†ç»„æˆï¼š1. æ¥å£åœ°å€(ä¹Ÿå°±æ˜¯URLåœ°å€)ã€2. è¯·æ±‚æ–¹å¼(ä¸€èˆ¬å°±æ˜¯getã€setï¼Œå½“ç„¶è¿˜æœ‰putã€delete)ã€3. è¯·æ±‚æ•°æ®(requestï¼Œæœ‰headè·Ÿbody)ã€4. å“åº”æ•°æ®(response)"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-26T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-26T00:00:00+00:00"><meta property="article:tag" content="SpringBoot"><meta name=twitter:card content="summary"><meta name=twitter:title content="SpringBootä¼˜åŒ–Controllerå±‚ä»£ç "><meta name=twitter:description content="æœ¬ç¯‡ä¸»è¦ä»‹ç»çš„å°±æ˜¯ controller å±‚çš„ä¸€äº›ä¼˜é›…æŠ€å·§ï¼Œä¸€ä¸ªå®Œæ•´çš„åç«¯è¯·æ±‚ç”±4éƒ¨åˆ†ç»„æˆï¼š1. æ¥å£åœ°å€(ä¹Ÿå°±æ˜¯URLåœ°å€)ã€2. è¯·æ±‚æ–¹å¼(ä¸€èˆ¬å°±æ˜¯getã€setï¼Œå½“ç„¶è¿˜æœ‰putã€delete)ã€3. è¯·æ±‚æ•°æ®(requestï¼Œæœ‰headè·Ÿbody)ã€4. å“åº”æ•°æ®(response)"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“š åšå®¢","item":"http://localhost:1313/blog/posts/"},{"@type":"ListItem","position":2,"name":"SpringBootä¼˜åŒ–Controllerå±‚ä»£ç ","item":"http://localhost:1313/blog/posts/operation/springboot%E4%BC%98%E5%8C%96controller%E5%B1%82%E4%BB%A3%E7%A0%81/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SpringBootä¼˜åŒ–Controllerå±‚ä»£ç ","name":"SpringBootä¼˜åŒ–Controllerå±‚ä»£ç ","description":"æœ¬ç¯‡ä¸»è¦ä»‹ç»çš„å°±æ˜¯ controller å±‚çš„ä¸€äº›ä¼˜é›…æŠ€å·§ï¼Œä¸€ä¸ªå®Œæ•´çš„åç«¯è¯·æ±‚ç”±4éƒ¨åˆ†ç»„æˆï¼š1. æ¥å£åœ°å€(ä¹Ÿå°±æ˜¯URLåœ°å€)ã€2. è¯·æ±‚æ–¹å¼(ä¸€èˆ¬å°±æ˜¯getã€setï¼Œå½“ç„¶è¿˜æœ‰putã€delete)ã€3. è¯·æ±‚æ•°æ®(requestï¼Œæœ‰headè·Ÿbody)ã€4. å“åº”æ•°æ®(response)\n","keywords":["SpringBoot"],"articleBody":"æœ¬ç¯‡ä¸»è¦ä»‹ç»çš„å°±æ˜¯ controller å±‚çš„ä¸€äº›ä¼˜é›…æŠ€å·§ï¼Œä¸€ä¸ªå®Œæ•´çš„åç«¯è¯·æ±‚ç”±4éƒ¨åˆ†ç»„æˆï¼š1. æ¥å£åœ°å€(ä¹Ÿå°±æ˜¯URLåœ°å€)ã€2. è¯·æ±‚æ–¹å¼(ä¸€èˆ¬å°±æ˜¯getã€setï¼Œå½“ç„¶è¿˜æœ‰putã€delete)ã€3. è¯·æ±‚æ•°æ®(requestï¼Œæœ‰headè·Ÿbody)ã€4. å“åº”æ•°æ®(response)\næœ¬ç¯‡å°†è§£å†³ä»¥ä¸‹3ä¸ªé—®é¢˜ï¼š\nå½“æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå¦‚ä½•ä¼˜é›…çš„æ ¡éªŒå‚æ•° è¿”å›å“åº”æ•°æ®è¯¥å¦‚ä½•ç»Ÿä¸€çš„è¿›è¡Œå¤„ç† æ¥æ”¶åˆ°è¯·æ±‚ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘æ—¶æŠ›å‡ºäº†å¼‚å¸¸åˆè¯¥å¦‚ä½•å¤„ç† ç»Ÿä¸€è¿”å›æ ¼å¼ å°è£…ResultVo é¦–å…ˆå…ˆå®šä¹‰ä¸€ä¸ªçŠ¶æ€ç çš„æ¥å£ï¼Œæ‰€æœ‰çŠ¶æ€ç éƒ½éœ€è¦å®ç°å®ƒï¼Œæœ‰äº†æ ‡å‡†æ‰å¥½åšäº‹ public interface StatusCode { public int getCode(); public String getMsg(); } ä¸å‰ç«¯è§„å®šå¥½è‡ªå®šä¹‰çŠ¶æ€ç  @Getter @AllArgsConstructor @NoArgsConstructor public enum ResultCode implements StatusCode { SUCCESS(1000, \"è¯·æ±‚æˆåŠŸ\"), FAILED(1001, \"è¯·æ±‚å¤±è´¥\"), VALIDATE_ERROR(1002, \"å‚æ•°æ ¡éªŒå¤±è´¥\"), RESPONSE_PACK_ERROR(1003, \"responseè¿”å›åŒ…è£…å¤±è´¥\"); private int code; private String msg; } å®šä¹‰ ResultVo åŒ…è£…ç±» @Data public class ResultVo { // çŠ¶æ€ç  private int code; // çŠ¶æ€ä¿¡æ¯ private String msg; // è¿”å›å¯¹è±¡ private Object data; // æ‰‹åŠ¨è®¾ç½®è¿”å›vo public ResultVo(int code, String msg, Object data) { this.code = code; this.msg = msg; this.data = data; } // é»˜è®¤è¿”å›æˆåŠŸçŠ¶æ€ç ï¼Œæ•°æ®å¯¹è±¡ public ResultVo(Object data) { this.code = ResultCode.SUCCESS.getCode(); this.msg = ResultCode.SUCCESS.getMsg(); this.data = data; } // è¿”å›æŒ‡å®šçŠ¶æ€ç ï¼Œæ•°æ®å¯¹è±¡ public ResultVo(StatusCode statusCode, Object data) { this.code = statusCode.getCode(); this.msg = statusCode.getMsg(); this.data = data; } // åªè¿”å›çŠ¶æ€ç  public ResultVo(StatusCode statusCode) { this.code = statusCode.getCode(); this.msg = statusCode.getMsg(); this.data = null; } } ç»Ÿä¸€æ ¡éªŒ å¼•å…¥ä¾èµ– ç”±äºæ–°ç‰ˆ Spring Boot å·²ä¸å†…ç½®æ ¡éªŒæ¨¡å—ï¼Œéœ€è‡ªå·±å¼•å…¥ç›¸åº”çš„åŒ…\norg.springframework.boot spring-boot-starter-validation é€šè¿‡@Validatedå®ç°å‚æ•°æ ¡éªŒ @Data public class AddUserVo { @NotNull(message = \"ç”¨æˆ·åä¸èƒ½ä¸ºç©º\") private String userName; @Length(min = 8, message = \"å¯†ç æœ€å°‘éœ€è¦8ä½\") private String password; private Integer age; } @PostMapping(\"/addUser\") public AddUserVo addUser(@Validated AddUserVo userVo) { return userVo; } è™½ç„¶æˆåŠŸæ ¡éªŒäº†å‚æ•°ï¼Œä¹Ÿè¿”å›äº†å¼‚å¸¸ï¼Œä½†æ˜¯è¿”å›çš„å¼‚å¸¸ä¸ç¬¦åˆé¢„æœŸï¼Œä¸æˆ‘ä»¬ä¹‹å‰å®šä¹‰äº†çš„ç»Ÿä¸€çŠ¶æ€ç ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¿›è¡Œä¼˜åŒ–ä¸€ä¸‹ï¼Œæ¯æ¬¡å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œè‡ªåŠ¨æŠŠçŠ¶æ€ç å†™å¥½ã€‚\nä¼˜åŒ–å¼‚å¸¸å¤„ç† æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶å°çœ‹å‡ºï¼Œæ ¡éªŒå‚æ•°æŠ›å‡ºäº†ä»€ä¹ˆå¼‚å¸¸\nResolved [org.springframework.validation.BindException: org.springframework.validation.BeanPropertyBindingResult: 1 errors æˆ‘ä»¬çœ‹åˆ°ä»£ç æŠ›å‡ºäº†org.springframework.validation.BindExceptionçš„ç»‘å®šå¼‚å¸¸ï¼Œå› æ­¤æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯AOPæ‹¦æˆªæ‰€æœ‰controllerï¼Œç„¶åå¼‚å¸¸çš„æ—¶å€™ç»Ÿä¸€æ‹¦æˆªèµ·æ¥ï¼Œè¿›è¡Œå°è£…ï¼\nä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ Spring Boot æä¾›çš„@RestControllerAdviceæ¥å¢å¼ºæ‰€æœ‰@RestControllerï¼Œç„¶åä½¿ç”¨@ExceptionHandleræ³¨è§£ï¼Œå°±å¯ä»¥æ‹¦æˆªåˆ°å¯¹åº”çš„å¼‚å¸¸ã€‚è¿™æ ·å¼€å‘èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šã€‚\nè¿™é‡Œæˆ‘ä»¬å°±æ‹¦æˆªBindException.classå°±å¥½äº†ã€‚æœ€ååœ¨è¿”å›ä¹‹å‰ï¼Œæˆ‘ä»¬å¯¹å¼‚å¸¸ä¿¡æ¯è¿›è¡ŒåŒ…è£…ä¸€ä¸‹ï¼ŒåŒ…è£…æˆResultVoï¼Œå½“ç„¶è¦è·Ÿä¸ŠResultCode.VALIDATE_ERRORçš„å¼‚å¸¸çŠ¶æ€ç ã€‚\n@RestControllerAdvice public class ControllerExceptionAdvice { @ExceptionHandler({BindException.class}) public ResultVo MethodArgumentNotValidExceptionHandler(BindException e){ // ä»å¼‚å¸¸å¯¹è±¡ä¸­æ‹¿åˆ°ObjectErrorå¯¹è±¡ ObjectError objectError = e.getBindingResult().getAllErrors().get(0); return new ResultVo(ResultCode.VALIDATE_ERROR, objectError.getDefaultMessage()); } } ç»Ÿä¸€å“åº” ç»Ÿä¸€åŒ…è£…å“åº” å‰é¢å†™çš„ResultVoå¯¼è‡´æ¯ä¸€ä¸ªæ¥å£éƒ½éœ€è¦å†™new ResultVo(data)ï¼Œè¿™æ ·å¼€å‘å°å“¥è‚¯å®šä¸ä¹æ„äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¼˜åŒ–å°è£…ï¼Œè®©AOPæ‹¦æˆªæ‰€æœ‰Controllerï¼Œç„¶åå†è‡ªåŠ¨åŒ…ä¸€å±‚ResultVoã€‚\nä½†æ˜¯ Spring Boot ä¸­ä¹Ÿæœ‰ç°æˆçš„ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼š\n@RestControllerAdvice public class ControllerResponseAdvice implements ResponseBodyAdvice\u003cObject\u003e { @Override public boolean supports(MethodParameter returnType, Class\u003c? extends HttpMessageConverter\u003c?\u003e\u003e converterType) { // responseæ˜¯ResultVoç±»å‹ï¼Œæˆ–è€…æ³¨é‡Šäº†NotControllerResponseAdviceéƒ½ä¸è¿›è¡ŒåŒ…è£… return !(returnType.getParameterType().isAssignableFrom(ResultVo.class)); } @Override public Object beforeBodyWrite(Object body, MethodParameter returnType, MediaType selectedContentType, Class\u003c? extends HttpMessageConverter\u003c?\u003e\u003e selectedConverterType, ServerHttpRequest request, ServerHttpResponse response) { // Stringç±»å‹ä¸èƒ½ç›´æ¥åŒ…è£… if (returnType.getGenericParameterType().equals(String.class)){ ObjectMapper objectMapper = new ObjectMapper(); try { // å°†æ•°æ®åŒ…è£…åœ¨ResultVoé‡Œåè½¬æ¢ä¸ºjsonä¸²è¿›è¡Œè¿”å› return objectMapper.writeValueAsString(new ResultVo(body)); } catch (JsonProcessingException e) { throw new RuntimeException(e); } } // å¦åˆ™ç›´æ¥åŒ…è£…æˆResultVoè¿”å› return new ResultVo(body); } } @RestControllerAdvice(basePackages = {\"com.example\"})è‡ªåŠ¨æ‰«æäº†æ‰€æœ‰æŒ‡å®šåŒ…ä¸‹çš„controllerï¼Œåœ¨Responseæ—¶è¿›è¡Œç»Ÿä¸€å¤„ç† é‡å†™supportsæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è¿”å›ç±»å‹å·²ç»æ˜¯ResultVoäº†ï¼Œé‚£å°±ä¸éœ€è¦å°è£…äº†ï¼Œå½“ä¸ç­‰ä¸ResultVoæ—¶æ‰è¿›è¡Œè°ƒç”¨beforeBodyWriteæ–¹æ³•ï¼Œè·Ÿè¿‡æ»¤å™¨çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ æœ€åé‡å†™æˆ‘ä»¬çš„å°è£…æ–¹æ³•beforeBodyWriteï¼Œæ³¨æ„é™¤äº†Stringçš„è¿”å›å€¼æœ‰ç‚¹ç‰¹æ®Šï¼Œæ— æ³•ç›´æ¥å°è£…æˆjsonï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå…¶ä»–çš„ç›´æ¥new ResultVo(data);å°±okäº† NOTç»Ÿä¸€å“åº” æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¸éœ€è¦åŒ…è£…ä¸€å±‚ç»Ÿä¸€å“åº”ï¼Œæ¯”å¦‚é¡¹ç›®ä¸­é›†æˆäº†ä¸€ä¸ªå¥åº·æ£€æµ‹çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯ä¸éœ€è¦åŒ…è£…ç»Ÿä¸€å“åº”çš„ï¼Œå¯¼è‡´æœ€åæ¥å£å¯¹åº”ä¸ä¸Šã€‚\n@GetMapping(\"/health\") public String health(Integer id) { return \"success\"; } å› ä¸ºç™¾åˆ†ä¹‹99çš„è¯·æ±‚è¿˜æ˜¯éœ€è¦åŒ…è£…çš„ï¼Œåªæœ‰ä¸ªåˆ«ä¸éœ€è¦ï¼Œå†™åœ¨åŒ…è£…çš„è¿‡æ»¤å™¨å§ï¼Ÿåˆä¸æ˜¯å¾ˆå¥½ç»´æŠ¤ï¼Œé‚£å°±åŠ ä¸ªæ³¨è§£å¥½äº†ã€‚æ‰€æœ‰ä¸éœ€è¦åŒ…è£…çš„å°±åŠ ä¸Šè¿™ä¸ªæ³¨è§£ã€‚\n@Target({ElementType.METHOD}) @Retention(RetentionPolicy.RUNTIME) public @interface NotControllerResponseAdvice { } ç„¶ååœ¨æˆ‘ä»¬çš„å¢å¼ºè¿‡æ»¤æ–¹æ³•ä¸Šè¿‡æ»¤åŒ…å«è¿™ä¸ªæ³¨è§£çš„æ–¹æ³•\n@RestControllerAdvice public class ControllerResponseAdvice implements ResponseBodyAdvice\u003cObject\u003e { @Override public boolean supports(MethodParameter returnType, Class\u003c? extends HttpMessageConverter\u003c?\u003e\u003e converterType) { // responseæ˜¯ResultVoç±»å‹ï¼Œæˆ–è€…æ³¨é‡Šäº†NotControllerResponseAdviceéƒ½ä¸è¿›è¡ŒåŒ…è£… return !(returnType.getParameterType().isAssignableFrom(ResultVo.class) || returnType.hasMethodAnnotation(NotControllerResponseAdvice.class)); } ... æœ€åå°±åœ¨ä¸éœ€è¦åŒ…è£…çš„æ–¹æ³•ä¸ŠåŠ ä¸Šæ³¨è§£\n@GetMapping(\"/health\") @NotControllerResponseAdvice public String health(Integer id) { return \"success\"; } ç»Ÿä¸€å¼‚å¸¸ æ¯ä¸ªç³»ç»Ÿéƒ½ä¼šæœ‰è‡ªå·±çš„ä¸šåŠ¡å¼‚å¸¸ï¼Œæ¯”å¦‚åº“å­˜ä¸èƒ½å°äº0å­ç±»çš„ï¼Œè¿™ç§å¼‚å¸¸å¹¶éç¨‹åºå¼‚å¸¸ï¼Œè€Œæ˜¯ä¸šåŠ¡æ“ä½œå¼•å‘çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è¿›è¡Œè§„èŒƒçš„ç¼–æ’ä¸šåŠ¡å¼‚å¸¸çŠ¶æ€ç ï¼Œå¹¶ä¸”å†™ä¸€ä¸ªä¸“é—¨å¤„ç†çš„å¼‚å¸¸ç±»ï¼Œæœ€åé€šè¿‡åˆšåˆšå­¦ä¹ è¿‡çš„å¼‚å¸¸æ‹¦æˆªç»Ÿä¸€è¿›è¡Œå¤„ç†ï¼Œä»¥åŠæ‰“æ—¥å¿—ã€‚\nå¼‚å¸¸çŠ¶æ€ç æšä¸¾ï¼Œæ—¢ç„¶æ˜¯çŠ¶æ€ç ï¼Œé‚£å°±è‚¯å®šè¦å®ç°æˆ‘ä»¬çš„æ ‡å‡†æ¥å£StatusCode @Getter @NoArgsConstructor @AllArgsConstructor public enum AppCode implements StatusCode { APP_ERROR(2000, \"ä¸šåŠ¡å¼‚å¸¸\"); private int code; private String msg; } å¼‚å¸¸ç±» @Getter public class APIException extends RuntimeException { private int code; private String msg; // æ‰‹åŠ¨è®¾ç½®å¼‚å¸¸ public APIException(StatusCode statusCode, String message) { // messageç”¨äºç”¨æˆ·è®¾ç½®æŠ›å‡ºé”™è¯¯è¯¦æƒ…ï¼Œä¾‹å¦‚ï¼šå½“å‰ä»·æ ¼-5ï¼Œå°äº0 super(message); // çŠ¶æ€ç  this.code = statusCode.getCode(); // çŠ¶æ€ç é…å¥—çš„msg this.msg = statusCode.getMsg(); } // é»˜è®¤å¼‚å¸¸ä½¿ç”¨APP_ERRORçŠ¶æ€ç  public APIException(String message) { super(message); this.code = AppCode.APP_ERROR.getCode(); this.msg = AppCode.APP_ERROR.getMsg(); } } æœ€åè¿›è¡Œç»Ÿä¸€å¼‚å¸¸çš„æ‹¦æˆª @RestControllerAdvice public class ControllerExceptionAdvice { @ExceptionHandler({BindException.class}) public ResultVo MethodArgumentNotValidExceptionHandler(BindException e){ // ä»å¼‚å¸¸å¯¹è±¡ä¸­æ‹¿åˆ°ObjectErrorå¯¹è±¡ ObjectError objectError = e.getBindingResult().getAllErrors().get(0); return new ResultVo(ResultCode.VALIDATE_ERROR, objectError.getDefaultMessage()); } @ExceptionHandler(APIException.class) public ResultVo APIExceptionHandler(APIException e) { // log.error(e.getMessage(), e); ç”±äºè¿˜æ²¡é›†æˆæ—¥å¿—æ¡†æ¶ï¼Œæš‚ä¸”æ”¾ç€ï¼Œå†™ä¸ŠTODO return new ResultVo(e.getCode(), e.getMsg(), e.getMessage()); } } æœ€åä½¿ç”¨ï¼Œæˆ‘ä»¬çš„ä»£ç åªéœ€è¦è¿™ä¹ˆå†™ @GetMapping(\"/error\") public String error(Integer id) { if (id.equals(0)){ throw new APIException(\"ç”¨æˆ·ä¸å­˜åœ¨\"); } return \"error\"; } å°±ä¼šè‡ªåŠ¨æŠ›å‡ºAppCode.APP_ERRORçŠ¶æ€ç çš„å“åº”ï¼Œå¹¶ä¸”å¸¦ä¸Šå¼‚å¸¸è¯¦ç»†ä¿¡æ¯ç”¨æˆ·ä¸å­˜åœ¨ã€‚\n","wordCount":"2456","inLanguage":"zh-cn","datePublished":"2022-11-26T00:00:00Z","dateModified":"2022-11-26T00:00:00Z","author":{"@type":"Person","name":"Lesan"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/blog/posts/operation/springboot%E4%BC%98%E5%8C%96controller%E5%B1%82%E4%BB%A3%E7%A0%81/"},"publisher":{"@type":"Organization","name":"Lesan's Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/blog/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/blog/ accesskey=h title="Lesan's Blog (Alt + H)">Lesan's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/blog/archives title="ğŸ“š å½’æ¡£"><span>ğŸ“š å½’æ¡£</span></a></li><li><a href=http://localhost:1313/blog/categories/ title="ğŸ—ƒï¸ åˆ†ç±»"><span>ğŸ—ƒï¸ åˆ†ç±»</span></a></li><li><a href=http://localhost:1313/blog/tags/ title="ğŸ·ï¸ æ ‡ç­¾"><span>ğŸ·ï¸ æ ‡ç­¾</span></a></li><li><a href=http://localhost:1313/blog/search/ title="ğŸ” æœç´¢"><span>ğŸ” æœç´¢</span></a></li><li><a href=http://localhost:1313/blog/about/ title="ğŸ‘¨â€ğŸ’» å…³äºæˆ‘"><span>ğŸ‘¨â€ğŸ’» å…³äºæˆ‘</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/blog/>Home</a>&nbsp;Â»&nbsp;<a href=http://localhost:1313/blog/posts/>ğŸ“š åšå®¢</a></div><h1 class="post-title entry-hint-parent">SpringBootä¼˜åŒ–Controllerå±‚ä»£ç </h1><div class=post-meta><span title='2022-11-26 00:00:00 +0000 UTC'>2022-11-26</span>&nbsp;Â·&nbsp;5 min&nbsp;Â·&nbsp;Lesan</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e7%bb%9f%e4%b8%80%e8%bf%94%e5%9b%9e%e6%a0%bc%e5%bc%8f aria-label=ç»Ÿä¸€è¿”å›æ ¼å¼>ç»Ÿä¸€è¿”å›æ ¼å¼</a><ul><li><a href=#%e5%b0%81%e8%a3%85resultvo aria-label=å°è£…ResultVo>å°è£…ResultVo</a></li></ul></li><li><a href=#%e7%bb%9f%e4%b8%80%e6%a0%a1%e9%aa%8c aria-label=ç»Ÿä¸€æ ¡éªŒ>ç»Ÿä¸€æ ¡éªŒ</a><ul><li><a href=#%e5%bc%95%e5%85%a5%e4%be%9d%e8%b5%96 aria-label=å¼•å…¥ä¾èµ–>å¼•å…¥ä¾èµ–</a></li><li><a href=#%e9%80%9a%e8%bf%87validated%e5%ae%9e%e7%8e%b0%e5%8f%82%e6%95%b0%e6%a0%a1%e9%aa%8c aria-label=é€šè¿‡@Validatedå®ç°å‚æ•°æ ¡éªŒ>é€šè¿‡@Validatedå®ç°å‚æ•°æ ¡éªŒ</a></li><li><a href=#%e4%bc%98%e5%8c%96%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86 aria-label=ä¼˜åŒ–å¼‚å¸¸å¤„ç†>ä¼˜åŒ–å¼‚å¸¸å¤„ç†</a></li></ul></li><li><a href=#%e7%bb%9f%e4%b8%80%e5%93%8d%e5%ba%94 aria-label=ç»Ÿä¸€å“åº”>ç»Ÿä¸€å“åº”</a><ul><li><a href=#%e7%bb%9f%e4%b8%80%e5%8c%85%e8%a3%85%e5%93%8d%e5%ba%94 aria-label=ç»Ÿä¸€åŒ…è£…å“åº”>ç»Ÿä¸€åŒ…è£…å“åº”</a></li><li><a href=#not%e7%bb%9f%e4%b8%80%e5%93%8d%e5%ba%94 aria-label=NOTç»Ÿä¸€å“åº”>NOTç»Ÿä¸€å“åº”</a></li></ul></li><li><a href=#%e7%bb%9f%e4%b8%80%e5%bc%82%e5%b8%b8 aria-label=ç»Ÿä¸€å¼‚å¸¸>ç»Ÿä¸€å¼‚å¸¸</a></li></ul></div></details></div><div class=post-content><p>æœ¬ç¯‡ä¸»è¦ä»‹ç»çš„å°±æ˜¯ <code>controller</code> å±‚çš„ä¸€äº›ä¼˜é›…æŠ€å·§ï¼Œä¸€ä¸ªå®Œæ•´çš„åç«¯è¯·æ±‚ç”±4éƒ¨åˆ†ç»„æˆï¼š1. <code>æ¥å£åœ°å€</code>(ä¹Ÿå°±æ˜¯URLåœ°å€)ã€2. <code>è¯·æ±‚æ–¹å¼</code>(ä¸€èˆ¬å°±æ˜¯getã€setï¼Œå½“ç„¶è¿˜æœ‰putã€delete)ã€3. <code>è¯·æ±‚æ•°æ®</code>(requestï¼Œæœ‰headè·Ÿbody)ã€4. <code>å“åº”æ•°æ®</code>(response)</p><p>æœ¬ç¯‡å°†è§£å†³ä»¥ä¸‹3ä¸ªé—®é¢˜ï¼š</p><ol><li>å½“æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå¦‚ä½•ä¼˜é›…çš„æ ¡éªŒå‚æ•°</li><li>è¿”å›å“åº”æ•°æ®è¯¥å¦‚ä½•ç»Ÿä¸€çš„è¿›è¡Œå¤„ç†</li><li>æ¥æ”¶åˆ°è¯·æ±‚ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘æ—¶æŠ›å‡ºäº†å¼‚å¸¸åˆè¯¥å¦‚ä½•å¤„ç†</li></ol><h2 id=ç»Ÿä¸€è¿”å›æ ¼å¼>ç»Ÿä¸€è¿”å›æ ¼å¼<a hidden class=anchor aria-hidden=true href=#ç»Ÿä¸€è¿”å›æ ¼å¼>#</a></h2><h3 id=å°è£…resultvo>å°è£…ResultVo<a hidden class=anchor aria-hidden=true href=#å°è£…resultvo>#</a></h3><ol><li>é¦–å…ˆå…ˆå®šä¹‰ä¸€ä¸ª<code>çŠ¶æ€ç </code>çš„æ¥å£ï¼Œæ‰€æœ‰<code>çŠ¶æ€ç </code>éƒ½éœ€è¦å®ç°å®ƒï¼Œæœ‰äº†æ ‡å‡†æ‰å¥½åšäº‹</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>StatusCode</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getMsg</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol start=2><li>ä¸å‰ç«¯è§„å®šå¥½è‡ªå®šä¹‰çŠ¶æ€ç </li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Getter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>ResultCode</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>StatusCode</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SUCCESS</span><span class=p>(</span><span class=n>1000</span><span class=p>,</span><span class=w> </span><span class=s>&#34;è¯·æ±‚æˆåŠŸ&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>FAILED</span><span class=p>(</span><span class=n>1001</span><span class=p>,</span><span class=w> </span><span class=s>&#34;è¯·æ±‚å¤±è´¥&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>VALIDATE_ERROR</span><span class=p>(</span><span class=n>1002</span><span class=p>,</span><span class=w> </span><span class=s>&#34;å‚æ•°æ ¡éªŒå¤±è´¥&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>RESPONSE_PACK_ERROR</span><span class=p>(</span><span class=n>1003</span><span class=p>,</span><span class=w> </span><span class=s>&#34;responseè¿”å›åŒ…è£…å¤±è´¥&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>msg</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol start=3><li>å®šä¹‰ <code>ResultVo</code> åŒ…è£…ç±»</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ResultVo</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// çŠ¶æ€ç </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// çŠ¶æ€ä¿¡æ¯</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>msg</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è¿”å›å¯¹è±¡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// æ‰‹åŠ¨è®¾ç½®è¿”å›vo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ResultVo</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>msg</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>msg</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// é»˜è®¤è¿”å›æˆåŠŸçŠ¶æ€ç ï¼Œæ•°æ®å¯¹è±¡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ResultVo</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ResultCode</span><span class=p>.</span><span class=na>SUCCESS</span><span class=p>.</span><span class=na>getCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ResultCode</span><span class=p>.</span><span class=na>SUCCESS</span><span class=p>.</span><span class=na>getMsg</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è¿”å›æŒ‡å®šçŠ¶æ€ç ï¼Œæ•°æ®å¯¹è±¡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ResultVo</span><span class=p>(</span><span class=n>StatusCode</span><span class=w> </span><span class=n>statusCode</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>statusCode</span><span class=p>.</span><span class=na>getCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>statusCode</span><span class=p>.</span><span class=na>getMsg</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// åªè¿”å›çŠ¶æ€ç </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>ResultVo</span><span class=p>(</span><span class=n>StatusCode</span><span class=w> </span><span class=n>statusCode</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>statusCode</span><span class=p>.</span><span class=na>getCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>statusCode</span><span class=p>.</span><span class=na>getMsg</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=ç»Ÿä¸€æ ¡éªŒ>ç»Ÿä¸€æ ¡éªŒ<a hidden class=anchor aria-hidden=true href=#ç»Ÿä¸€æ ¡éªŒ>#</a></h2><h3 id=å¼•å…¥ä¾èµ–>å¼•å…¥ä¾èµ–<a hidden class=anchor aria-hidden=true href=#å¼•å…¥ä¾èµ–>#</a></h3><p>ç”±äºæ–°ç‰ˆ <code>Spring Boot</code> å·²ä¸å†…ç½®æ ¡éªŒæ¨¡å—ï¼Œéœ€è‡ªå·±å¼•å…¥ç›¸åº”çš„åŒ…</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-validation<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id=é€šè¿‡validatedå®ç°å‚æ•°æ ¡éªŒ>é€šè¿‡<code>@Validated</code>å®ç°å‚æ•°æ ¡éªŒ<a hidden class=anchor aria-hidden=true href=#é€šè¿‡validatedå®ç°å‚æ•°æ ¡éªŒ>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AddUserVo</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@NotNull</span><span class=p>(</span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>userName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Length</span><span class=p>(</span><span class=n>min</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>8</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;å¯†ç æœ€å°‘éœ€è¦8ä½&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/addUser&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>AddUserVo</span><span class=w> </span><span class=nf>addUser</span><span class=p>(</span><span class=nd>@Validated</span><span class=w> </span><span class=n>AddUserVo</span><span class=w> </span><span class=n>userVo</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>userVo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>è™½ç„¶æˆåŠŸæ ¡éªŒäº†å‚æ•°ï¼Œä¹Ÿè¿”å›äº†å¼‚å¸¸ï¼Œä½†æ˜¯è¿”å›çš„å¼‚å¸¸ä¸ç¬¦åˆé¢„æœŸï¼Œä¸æˆ‘ä»¬ä¹‹å‰å®šä¹‰äº†çš„ç»Ÿä¸€çŠ¶æ€ç ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¿›è¡Œä¼˜åŒ–ä¸€ä¸‹ï¼Œæ¯æ¬¡å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œè‡ªåŠ¨æŠŠçŠ¶æ€ç å†™å¥½ã€‚</p><h3 id=ä¼˜åŒ–å¼‚å¸¸å¤„ç†>ä¼˜åŒ–å¼‚å¸¸å¤„ç†<a hidden class=anchor aria-hidden=true href=#ä¼˜åŒ–å¼‚å¸¸å¤„ç†>#</a></h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶å°çœ‹å‡ºï¼Œæ ¡éªŒå‚æ•°æŠ›å‡ºäº†ä»€ä¹ˆå¼‚å¸¸</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Resolved</span><span class=w> </span><span class=o>[</span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>validation</span><span class=p>.</span><span class=na>BindException</span><span class=p>:</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>validation</span><span class=p>.</span><span class=na>BeanPropertyBindingResult</span><span class=p>:</span><span class=w> </span><span class=n>1</span><span class=w> </span><span class=n>errors</span><span class=w>
</span></span></span></code></pre></div><p>æˆ‘ä»¬çœ‹åˆ°ä»£ç æŠ›å‡ºäº†<code>org.springframework.validation.BindException</code>çš„ç»‘å®šå¼‚å¸¸ï¼Œå› æ­¤æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯AOPæ‹¦æˆªæ‰€æœ‰controllerï¼Œç„¶åå¼‚å¸¸çš„æ—¶å€™ç»Ÿä¸€æ‹¦æˆªèµ·æ¥ï¼Œè¿›è¡Œå°è£…ï¼</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Spring Boot</code> æä¾›çš„<code>@RestControllerAdvice</code>æ¥å¢å¼ºæ‰€æœ‰<code>@RestController</code>ï¼Œç„¶åä½¿ç”¨<code>@ExceptionHandler</code>æ³¨è§£ï¼Œå°±å¯ä»¥æ‹¦æˆªåˆ°å¯¹åº”çš„å¼‚å¸¸ã€‚è¿™æ ·å¼€å‘èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å°±æ‹¦æˆªBindException.classå°±å¥½äº†ã€‚æœ€ååœ¨è¿”å›ä¹‹å‰ï¼Œæˆ‘ä»¬å¯¹å¼‚å¸¸ä¿¡æ¯è¿›è¡ŒåŒ…è£…ä¸€ä¸‹ï¼ŒåŒ…è£…æˆResultVoï¼Œå½“ç„¶è¦è·Ÿä¸ŠResultCode.VALIDATE_ERRORçš„å¼‚å¸¸çŠ¶æ€ç ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestControllerAdvice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ControllerExceptionAdvice</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>({</span><span class=n>BindException</span><span class=p>.</span><span class=na>class</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResultVo</span><span class=w> </span><span class=nf>MethodArgumentNotValidExceptionHandler</span><span class=p>(</span><span class=n>BindException</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// ä»å¼‚å¸¸å¯¹è±¡ä¸­æ‹¿åˆ°ObjectErrorå¯¹è±¡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ObjectError</span><span class=w> </span><span class=n>objectError</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getBindingResult</span><span class=p>().</span><span class=na>getAllErrors</span><span class=p>().</span><span class=na>get</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResultVo</span><span class=p>(</span><span class=n>ResultCode</span><span class=p>.</span><span class=na>VALIDATE_ERROR</span><span class=p>,</span><span class=w> </span><span class=n>objectError</span><span class=p>.</span><span class=na>getDefaultMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=ç»Ÿä¸€å“åº”>ç»Ÿä¸€å“åº”<a hidden class=anchor aria-hidden=true href=#ç»Ÿä¸€å“åº”>#</a></h2><h3 id=ç»Ÿä¸€åŒ…è£…å“åº”>ç»Ÿä¸€åŒ…è£…å“åº”<a hidden class=anchor aria-hidden=true href=#ç»Ÿä¸€åŒ…è£…å“åº”>#</a></h3><p>å‰é¢å†™çš„<code>ResultVo</code>å¯¼è‡´æ¯ä¸€ä¸ªæ¥å£éƒ½éœ€è¦å†™<code>new ResultVo(data)</code>ï¼Œè¿™æ ·å¼€å‘å°å“¥è‚¯å®šä¸ä¹æ„äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¼˜åŒ–å°è£…ï¼Œè®©<code>AOP</code>æ‹¦æˆªæ‰€æœ‰<code>Controller</code>ï¼Œç„¶åå†è‡ªåŠ¨åŒ…ä¸€å±‚<code>ResultVo</code>ã€‚</p><p>ä½†æ˜¯ <code>Spring Boot</code> ä¸­ä¹Ÿæœ‰ç°æˆçš„ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestControllerAdvice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ControllerResponseAdvice</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ResponseBodyAdvice</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>supports</span><span class=p>(</span><span class=n>MethodParameter</span><span class=w> </span><span class=n>returnType</span><span class=p>,</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;?</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>HttpMessageConverter</span><span class=o>&lt;?&gt;&gt;</span><span class=w> </span><span class=n>converterType</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// responseæ˜¯ResultVoç±»å‹ï¼Œæˆ–è€…æ³¨é‡Šäº†NotControllerResponseAdviceéƒ½ä¸è¿›è¡ŒåŒ…è£…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=o>!</span><span class=p>(</span><span class=n>returnType</span><span class=p>.</span><span class=na>getParameterType</span><span class=p>().</span><span class=na>isAssignableFrom</span><span class=p>(</span><span class=n>ResultVo</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>beforeBodyWrite</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>body</span><span class=p>,</span><span class=w> </span><span class=n>MethodParameter</span><span class=w> </span><span class=n>returnType</span><span class=p>,</span><span class=w> </span><span class=n>MediaType</span><span class=w> </span><span class=n>selectedContentType</span><span class=p>,</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;?</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>HttpMessageConverter</span><span class=o>&lt;?&gt;&gt;</span><span class=w> </span><span class=n>selectedConverterType</span><span class=p>,</span><span class=w> </span><span class=n>ServerHttpRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>ServerHttpResponse</span><span class=w> </span><span class=n>response</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Stringç±»å‹ä¸èƒ½ç›´æ¥åŒ…è£…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>returnType</span><span class=p>.</span><span class=na>getGenericParameterType</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ObjectMapper</span><span class=w> </span><span class=n>objectMapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ObjectMapper</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// å°†æ•°æ®åŒ…è£…åœ¨ResultVoé‡Œåè½¬æ¢ä¸ºjsonä¸²è¿›è¡Œè¿”å›</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>objectMapper</span><span class=p>.</span><span class=na>writeValueAsString</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>ResultVo</span><span class=p>(</span><span class=n>body</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>JsonProcessingException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// å¦åˆ™ç›´æ¥åŒ…è£…æˆResultVoè¿”å›</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResultVo</span><span class=p>(</span><span class=n>body</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol><li><code>@RestControllerAdvice(basePackages = {"com.example"})</code>è‡ªåŠ¨æ‰«æäº†æ‰€æœ‰æŒ‡å®šåŒ…ä¸‹çš„<code>controller</code>ï¼Œåœ¨<code>Response</code>æ—¶è¿›è¡Œç»Ÿä¸€å¤„ç†</li><li>é‡å†™<code>supports</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è¿”å›ç±»å‹å·²ç»æ˜¯<code>ResultVo</code>äº†ï¼Œé‚£å°±ä¸éœ€è¦å°è£…äº†ï¼Œå½“ä¸ç­‰ä¸<code>ResultVo</code>æ—¶æ‰è¿›è¡Œè°ƒç”¨<code>beforeBodyWrite</code>æ–¹æ³•ï¼Œè·Ÿè¿‡æ»¤å™¨çš„æ•ˆæœæ˜¯ä¸€æ ·çš„</li><li>æœ€åé‡å†™æˆ‘ä»¬çš„å°è£…æ–¹æ³•<code>beforeBodyWrite</code>ï¼Œæ³¨æ„é™¤äº†<code>String</code>çš„è¿”å›å€¼æœ‰ç‚¹ç‰¹æ®Šï¼Œæ— æ³•ç›´æ¥å°è£…æˆjsonï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå…¶ä»–çš„ç›´æ¥<code>new ResultVo(data);</code>å°±okäº†</li></ol><h3 id=notç»Ÿä¸€å“åº”>NOTç»Ÿä¸€å“åº”<a hidden class=anchor aria-hidden=true href=#notç»Ÿä¸€å“åº”>#</a></h3><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¸éœ€è¦åŒ…è£…ä¸€å±‚ç»Ÿä¸€å“åº”ï¼Œæ¯”å¦‚é¡¹ç›®ä¸­é›†æˆäº†ä¸€ä¸ª<code>å¥åº·æ£€æµ‹</code>çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯ä¸éœ€è¦åŒ…è£…ç»Ÿä¸€å“åº”çš„ï¼Œå¯¼è‡´æœ€åæ¥å£å¯¹åº”ä¸ä¸Šã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/health&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>health</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=s>&#34;success&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>å› ä¸ºç™¾åˆ†ä¹‹99çš„è¯·æ±‚è¿˜æ˜¯éœ€è¦åŒ…è£…çš„ï¼Œåªæœ‰ä¸ªåˆ«ä¸éœ€è¦ï¼Œå†™åœ¨åŒ…è£…çš„è¿‡æ»¤å™¨å§ï¼Ÿåˆä¸æ˜¯å¾ˆå¥½ç»´æŠ¤ï¼Œé‚£å°±åŠ ä¸ªæ³¨è§£å¥½äº†ã€‚æ‰€æœ‰ä¸éœ€è¦åŒ…è£…çš„å°±åŠ ä¸Šè¿™ä¸ªæ³¨è§£ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Target</span><span class=p>({</span><span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=nd>@interface</span><span class=w> </span><span class=n>NotControllerResponseAdvice</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>ç„¶ååœ¨æˆ‘ä»¬çš„å¢å¼ºè¿‡æ»¤æ–¹æ³•ä¸Šè¿‡æ»¤åŒ…å«è¿™ä¸ªæ³¨è§£çš„æ–¹æ³•</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestControllerAdvice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ControllerResponseAdvice</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ResponseBodyAdvice</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>supports</span><span class=p>(</span><span class=n>MethodParameter</span><span class=w> </span><span class=n>returnType</span><span class=p>,</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;?</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>HttpMessageConverter</span><span class=o>&lt;?&gt;&gt;</span><span class=w> </span><span class=n>converterType</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// responseæ˜¯ResultVoç±»å‹ï¼Œæˆ–è€…æ³¨é‡Šäº†NotControllerResponseAdviceéƒ½ä¸è¿›è¡ŒåŒ…è£…</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=o>!</span><span class=p>(</span><span class=n>returnType</span><span class=p>.</span><span class=na>getParameterType</span><span class=p>().</span><span class=na>isAssignableFrom</span><span class=p>(</span><span class=n>ResultVo</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>returnType</span><span class=p>.</span><span class=na>hasMethodAnnotation</span><span class=p>(</span><span class=n>NotControllerResponseAdvice</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><p>æœ€åå°±åœ¨ä¸éœ€è¦åŒ…è£…çš„æ–¹æ³•ä¸ŠåŠ ä¸Šæ³¨è§£</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/health&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NotControllerResponseAdvice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>health</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=s>&#34;success&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=ç»Ÿä¸€å¼‚å¸¸>ç»Ÿä¸€å¼‚å¸¸<a hidden class=anchor aria-hidden=true href=#ç»Ÿä¸€å¼‚å¸¸>#</a></h2><p>æ¯ä¸ªç³»ç»Ÿéƒ½ä¼šæœ‰è‡ªå·±çš„<code>ä¸šåŠ¡å¼‚å¸¸</code>ï¼Œæ¯”å¦‚<code>åº“å­˜ä¸èƒ½å°äº0</code>å­ç±»çš„ï¼Œè¿™ç§å¼‚å¸¸å¹¶éç¨‹åºå¼‚å¸¸ï¼Œè€Œæ˜¯ä¸šåŠ¡æ“ä½œå¼•å‘çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è¿›è¡Œè§„èŒƒçš„ç¼–æ’ä¸šåŠ¡<code>å¼‚å¸¸çŠ¶æ€ç </code>ï¼Œå¹¶ä¸”å†™ä¸€ä¸ªä¸“é—¨å¤„ç†çš„<code>å¼‚å¸¸ç±»</code>ï¼Œæœ€åé€šè¿‡åˆšåˆšå­¦ä¹ è¿‡çš„<code>å¼‚å¸¸æ‹¦æˆª</code>ç»Ÿä¸€è¿›è¡Œå¤„ç†ï¼Œä»¥åŠæ‰“<code>æ—¥å¿—</code>ã€‚</p><ol><li>å¼‚å¸¸çŠ¶æ€ç æšä¸¾ï¼Œæ—¢ç„¶æ˜¯çŠ¶æ€ç ï¼Œé‚£å°±è‚¯å®šè¦å®ç°æˆ‘ä»¬çš„æ ‡å‡†æ¥å£<code>StatusCode</code></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Getter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>AppCode</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>StatusCode</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>APP_ERROR</span><span class=p>(</span><span class=n>2000</span><span class=p>,</span><span class=w> </span><span class=s>&#34;ä¸šåŠ¡å¼‚å¸¸&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>msg</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol start=2><li>å¼‚å¸¸ç±»</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Getter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>APIException</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>RuntimeException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>msg</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// æ‰‹åŠ¨è®¾ç½®å¼‚å¸¸</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>APIException</span><span class=p>(</span><span class=n>StatusCode</span><span class=w> </span><span class=n>statusCode</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// messageç”¨äºç”¨æˆ·è®¾ç½®æŠ›å‡ºé”™è¯¯è¯¦æƒ…ï¼Œä¾‹å¦‚ï¼šå½“å‰ä»·æ ¼-5ï¼Œå°äº0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>(</span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// çŠ¶æ€ç </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>statusCode</span><span class=p>.</span><span class=na>getCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// çŠ¶æ€ç é…å¥—çš„msg</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>statusCode</span><span class=p>.</span><span class=na>getMsg</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// é»˜è®¤å¼‚å¸¸ä½¿ç”¨APP_ERRORçŠ¶æ€ç </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>APIException</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>(</span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AppCode</span><span class=p>.</span><span class=na>APP_ERROR</span><span class=p>.</span><span class=na>getCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AppCode</span><span class=p>.</span><span class=na>APP_ERROR</span><span class=p>.</span><span class=na>getMsg</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol start=3><li>æœ€åè¿›è¡Œç»Ÿä¸€å¼‚å¸¸çš„æ‹¦æˆª</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestControllerAdvice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ControllerExceptionAdvice</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>({</span><span class=n>BindException</span><span class=p>.</span><span class=na>class</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResultVo</span><span class=w> </span><span class=nf>MethodArgumentNotValidExceptionHandler</span><span class=p>(</span><span class=n>BindException</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// ä»å¼‚å¸¸å¯¹è±¡ä¸­æ‹¿åˆ°ObjectErrorå¯¹è±¡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ObjectError</span><span class=w> </span><span class=n>objectError</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getBindingResult</span><span class=p>().</span><span class=na>getAllErrors</span><span class=p>().</span><span class=na>get</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResultVo</span><span class=p>(</span><span class=n>ResultCode</span><span class=p>.</span><span class=na>VALIDATE_ERROR</span><span class=p>,</span><span class=w> </span><span class=n>objectError</span><span class=p>.</span><span class=na>getDefaultMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>APIException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResultVo</span><span class=w> </span><span class=nf>APIExceptionHandler</span><span class=p>(</span><span class=n>APIException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// log.error(e.getMessage(), e); ç”±äºè¿˜æ²¡é›†æˆæ—¥å¿—æ¡†æ¶ï¼Œæš‚ä¸”æ”¾ç€ï¼Œå†™ä¸ŠTODO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResultVo</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getCode</span><span class=p>(),</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMsg</span><span class=p>(),</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol start=4><li>æœ€åä½¿ç”¨ï¼Œæˆ‘ä»¬çš„ä»£ç åªéœ€è¦è¿™ä¹ˆå†™</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/error&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>error</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>0</span><span class=p>)){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>APIException</span><span class=p>(</span><span class=s>&#34;ç”¨æˆ·ä¸å­˜åœ¨&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=s>&#34;error&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>å°±ä¼šè‡ªåŠ¨æŠ›å‡º<code>AppCode.APP_ERROR</code>çŠ¶æ€ç çš„å“åº”ï¼Œå¹¶ä¸”å¸¦ä¸Šå¼‚å¸¸è¯¦ç»†ä¿¡æ¯<code>ç”¨æˆ·ä¸å­˜åœ¨</code>ã€‚</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/blog/tags/springboot/>SpringBoot</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/blog/posts/knowledge/springboot%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3%E6%80%BB%E7%BB%93/><span class=title>Â«</span><br><span>SpringBootå¸¸ç”¨æ³¨è§£æ€»ç»“</span>
</a><a class=next href=http://localhost:1313/blog/posts/knowledge/sqlserver%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7/><span class=title>Â»</span><br><span>SQLServerä¸€äº›å°æŠ€å·§</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/blog/>Lesan's Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>